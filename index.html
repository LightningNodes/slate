
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta
            name="description"
            content="Documentation for the Pi42 APIs"
        >
    <title>Pi42 API Reference Documentation</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-257f3f58.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-966d6edc.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-024da600.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;javascript&quot;,&quot;python&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-9176f612.png" class="logo" alt="" />
        <div class="lang-selector">
              <a href="#" data-language-name="javascript">javascript</a>
              <a href="#" data-language-name="python">python</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#change-log" class="toc-h1 toc-link" data-title="Change Log">Change Log</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#17-09-2024" class="toc-h2 toc-link" data-title="17-09-2024">17-09-2024</a>
                  </li>
                  <li>
                    <a href="#17-07-2024" class="toc-h2 toc-link" data-title="17-07-2024">17-07-2024</a>
                  </li>
                  <li>
                    <a href="#9-07-2024" class="toc-h2 toc-link" data-title="9-07-2024">9-07-2024</a>
                  </li>
                  <li>
                    <a href="#19-06-2024" class="toc-h2 toc-link" data-title="19-06-2024">19-06-2024</a>
                  </li>
                  <li>
                    <a href="#06-06-2024" class="toc-h2 toc-link" data-title="06-06-2024">06-06-2024</a>
                  </li>
                  <li>
                    <a href="#28-05-2024" class="toc-h2 toc-link" data-title="28-05-2024">28-05-2024</a>
                  </li>
                  <li>
                    <a href="#20-05-2024" class="toc-h2 toc-link" data-title="20-05-2024">20-05-2024</a>
                  </li>
                  <li>
                    <a href="#10-05-2024" class="toc-h2 toc-link" data-title="10-05-2024">10-05-2024</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getting-started-with-pi42-apis" class="toc-h2 toc-link" data-title="Getting Started with Pi42 APIs">Getting Started with Pi42 APIs</a>
                  </li>
                  <li>
                    <a href="#get-request" class="toc-h2 toc-link" data-title="getRequest Function">getRequest Function</a>
                  </li>
                  <li>
                    <a href="#post-request" class="toc-h2 toc-link" data-title="postRequest Function">postRequest Function</a>
                  </li>
                  <li>
                    <a href="#put-request" class="toc-h2 toc-link" data-title="putRequest Function">putRequest Function</a>
                  </li>
                  <li>
                    <a href="#delete-request" class="toc-h2 toc-link" data-title="deleteRequest Function">deleteRequest Function</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#rate-limits" class="toc-h1 toc-link" data-title="API Rate Limits">API Rate Limits</a>
          </li>
          <li>
            <a href="#orders" class="toc-h1 toc-link" data-title="Orders">Orders</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#place-order" class="toc-h2 toc-link" data-title="Place an Order ">Place an Order </a>
                  </li>
                  <li>
                    <a href="#add-margin" class="toc-h2 toc-link" data-title=" Add Margin "> Add Margin </a>
                  </li>
                  <li>
                    <a href="#reduce-margin" class="toc-h2 toc-link" data-title="Reduce Margin">Reduce Margin</a>
                  </li>
                  <li>
                    <a href="#get-open-orders" class="toc-h2 toc-link" data-title="Get Open Orders">Get Open Orders</a>
                  </li>
                  <li>
                    <a href="#get-order-history" class="toc-h2 toc-link" data-title="Get Order History">Get Order History</a>
                  </li>
                  <li>
                    <a href="#get-linked-orders" class="toc-h2 toc-link" data-title="Get Linked Orders">Get Linked Orders</a>
                  </li>
                  <li>
                    <a href="#get-margin-history" class="toc-h2 toc-link" data-title="Fetch Margin History">Fetch Margin History</a>
                  </li>
                  <li>
                    <a href="#get-positions" class="toc-h2 toc-link" data-title="Get Positions">Get Positions</a>
                  </li>
                  <li>
                    <a href="#get-position-status" class="toc-h2 toc-link" data-title="Get Position Status">Get Position Status</a>
                  </li>
                  <li>
                    <a href="#trade-history" class="toc-h2 toc-link" data-title="Get User's Trade History">Get User's Trade History</a>
                  </li>
                  <li>
                    <a href="#get-transaction-history" class="toc-h2 toc-link" data-title="Get User's Transaction History">Get User's Transaction History</a>
                  </li>
                  <li>
                    <a href="#exchange-update-leverage" class="toc-h2 toc-link" data-title="Update Leverage">Update Leverage</a>
                  </li>
                  <li>
                    <a href="#delete-order" class="toc-h2 toc-link" data-title=" Deleting an Order"> Deleting an Order</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#public-endpoints" class="toc-h1 toc-link" data-title="Public Endpoints">Public Endpoints</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#ticker-update-24hr" class="toc-h2 toc-link" data-title="Ticker Update (24Hr)">Ticker Update (24Hr)</a>
                  </li>
                  <li>
                    <a href="#agg-trade-update" class="toc-h2 toc-link" data-title="Aggregate Trade Update">Aggregate Trade Update</a>
                  </li>
                  <li>
                    <a href="#depth-update" class="toc-h2 toc-link" data-title="Depth Update">Depth Update</a>
                  </li>
                  <li>
                    <a href="#klines" class="toc-h2 toc-link" data-title="Get Klines">Get Klines</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#web-sockets" class="toc-h1 toc-link" data-title="Web Sockets">Web Sockets</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#authenticated-web-sockets" class="toc-h2 toc-link" data-title="Authenticated Web Sockets">Authenticated Web Sockets</a>
                  </li>
                  <li>
                    <a href="#public-web-sockets" class="toc-h2 toc-link" data-title="Public Web Sockets">Public Web Sockets</a>
                  </li>
                  <li>
                    <a href="#create-listen-key" class="toc-h2 toc-link" data-title=" Create Listen Key "> Create Listen Key </a>
                  </li>
                  <li>
                    <a href="#get-listen-key" class="toc-h2 toc-link" data-title="Get Listen Key">Get Listen Key</a>
                  </li>
                  <li>
                    <a href="#update-listen-key" class="toc-h2 toc-link" data-title="Update Listen Key">Update Listen Key</a>
                  </li>
                  <li>
                    <a href="#delete-listen-key" class="toc-h2 toc-link" data-title="Delete Listen Key">Delete Listen Key</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#error-codes" class="toc-h1 toc-link" data-title=" Error Codes "> Error Codes </a>
          </li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <p><h1 id='change-log'>Change Log</h1><h2 id='17-09-2024'>17-09-2024</h2>
<ol>
<li>Additional authentication method with private web socket using listen key.</li>
<li>New Endpoints for listen key</li></p>

<ul>
  <li>Create new listen key for web-socket connection <code>(POST /v1/retail/listen-key)</code></li>
  <li>Update expiry time for listen key <code>(PUT /v1/retail/listen-key)</code></li>
  <li>Delete listen key <code>(DELETE /v1/retail/listen-key)</code></li>
</ul>

<p><li>Endpoints for CRUD Operations on api-key which are typically done through UI </li>
<ul>
  <li>Create a new api-key <code>(POST /v1/retail/create-api-key)</code></li>
  <li>Get all api-keys for user <code>(GET /v1/retail/all-api-keys)</code></li>
  <li>Delete api-key for user <code>(DELETE /v1/retail/delete-api-key)</code></li>
  <li>Update api-key trading permissions <code>(POST /v1/retail/update-api-key-permissions)</code></li>
  <li>Whitelist IPs for api-key <code>(POST /v1/retail/add-allowed-ips)</code></li>
  <li>Remove whitelisted IPs for api-key <code>(POST /v1/retail/remove-allowed-ips)</code></li>
</ul></p>

<p><br/>
</ol>
<h2 id='17-07-2024'>17-07-2024</h2>
<ol>
<li>Added Enum Value <code>GST_ON_FUNDING_FEE</code> in TransactionType</li>
<li>Exchange Info <br/></p>

<p><ul>
<li>Added optional query param <code>market</code></li>
<li>Added <code>markets</code>, <code>tags</code>, <code>assetPrecisions</code>, <code>conversionRates</code> in the response <br/></li>
<li>For each contract, from the response: <br/></p>

<p><ul>
<li> Removed: <code>marginAsset</code>, <code>maintMarginPercent</code> <br/></li>
<li> Added: <code>market</code>, <code>marginAssetsSupported</code>, <code>fundingFeeInterval</code> <br/></li>
</ul></li>
</ul></li>
<li>Open Orders, Order History, Linked Orders <br/></p>

<p><ul>
<li>Added <code>baseAsset</code>, <code>quoteAsset</code> in response <br/></li>
<li>Added <code>lockedMarginInMarginAsset</code>, <code>lockedMargin</code>, <code>stopPrice</code>, <code>marginAsset</code>, <code>leveragedQty</code> in Order History response <br/></li>
</ul></li>
<li>Add Margin/ Reduce Margin <br/></p>

<p><ul>
<li> Added <code>asset</code> in response <br/></li>
</ul></li>
<li>Get order using client order ID, Get order using ref ID <br/></p>

<p><ul>
<li>Added <code>lockedMarginInMarginAsset(optional)</code>, <code>baseAsset</code>, <code>quoteAsset</code>, <code>marginAsset</code> in response <br/></li>
</ul></li>
<li>Place Order <br/></p>

<p><ul>
<li> Added optional field <code>marginAsset</code> in body <br/></li>
<li>Added <code>lockedMarginInMarginAsset</code>, <code>baseAsset</code>, <code>quoteAsset</code>, <code>marginAsset</code> in response <br/></li>
</ul></li>
<li>Transaction History, Get Transaction using ID <br/></p>

<p><ul>
<li>Added baseAsset, quoteAsset in response <br/></li>
</ul></li>
<li>Trade History, Get Trade using ID <br/></p>

<p><ul>
<li>Added <code>baseAsset</code>, <code>quoteAsset</code> , <code>marginAsset</code>, <code>feeInMarginAsset(optional)</code>, <code>realizedProfitInMarginAsset</code>(optional) in
response</li>
</ul></li>
<li>Get Positions, Get Position using position id <br/></p>

<p><ul>
<li>Added baseAsset, quoteAsset , marginAsset, marginInMarginAsset(optional), realizedProfitInMarginAsset(optional) in
response</li>
</ul></li>
<li>Web Socket Updates <br/></p>

<p><ul>
<li>New Events Added:<br/></p>

<p><ul>
<li>Market Info ( marketInfo)<br/></li>
<li> Mark Price Stream for All market ( markPriceArr)<br/></li>
<li>All Market Tickers Streams( tickerArr)<br/></li>
</ul></li>
<li>Added new fields in the Response of following events <br/></p>

<p><ul>
<li>Order Events : <code>marginAsset</code>, <code>market</code> , <code>baseAsset</code>, <code>quoteAsset</code><br/></li>
<li>Position Events:<code>market</code>, <code>marginAsset</code>, <code>marginConversionRate</code>, <code>marginSettlementRate</code>, <code>marginInMarginAsset</code>,
<code>realizedProfitInMarginAsset</code> <br/></li>
<li>Trade Events: <code>feeInMarginAsset</code> <br/></li>
</ul></li>
</ul></li>
</ol>
<h2 id='9-07-2024'>9-07-2024</h2>
<ol>
<li>Pagination update of following APIs: <code>orderHistory</code>, <code>tradeHistory</code>, <code>transactionHistory</code>, <code>openOrders</code>, <code>positions</code></p>

<p><ul>
<li>Removed <code>timestamp</code> query param.</li>
<li>Added optional query params namely:</p>

<p><ul>
<li><code>startTimestamp</code> (lower bound) <br/></li>
<li> <code>endTimestamp</code> (upper bound) <br/></li>
<li> <code>sortOrder</code>(asc or desc) <br/></li>
</ul></li>
<li> Response: <code>nextTimestamp</code> which is used in the next paginated API call.</li>
<li>Examples added in the API descriptions section in the doc.</li>
</ul></li>
<li>New Endpoint</p>

<p><ul>
<li>Margin History ( GET /v1/order/fetch-margin-history)</li>
</ul></li>
</ol>
<h2 id='19-06-2024'>19-06-2024</h2>
<ol>
<li>Updated Pagination of following APIs: <code>orderHistory</code>, <code>tradeHistory</code>, <code>transactionHistory</code>, <code>openOrders</code></p>

<p><ul>
<li>Pagination changed from page basis to timestamp basis.</li>
<li>Introduced timestamp basis pagination in positions API.</li>
<li>Response gives a field <code>nextTimestamp</code>, which is used for next API call.</li>
</ul></li>
</ol>
<h2 id='06-06-2024'>06-06-2024</h2>
<ol>
<li>New Endpoints added</p>

<p><ul>
<li>Get Depth Update( GET <code>/v1/market/depth/:contractPair</code>)<br/></li>
<li>Get Aggregate trade update ( GET <code>/v1/market/aggTrade/:contractPair</code>)</li>
<li>Get order details using ref ID ( GET <code>/v1/order/ref-id</code>)</li>
<li>Get user id and account ID using ref ID ( GET <code>/v1/integration/user</code>)</li>
<li>Get fiat order details using reference ID ( GET <code>/v1/integration/fiat-order-details</code>)</li>
<li>Get 24hr ticker update ( GET <code>/v1/market/ticker24Hr/:contractPair</code>)</li>
<li>Get trade history based on trade ID ( GET <code>/v1/user-data/trade-history/{id}</code>)</li>
<li>Get transaction history based on transaction ID ( GET <code>/v1/user-data/transaction-history/{id}</code>)</li>
</ul></li>
<li>Updated Endpoints</p>

<p><ul>
<li>Two new optional query params( tradeId and positionId) added in ( GET <code>/v1/user-data/transaction-history</code>).</li>
<li>Updates in body of ( POST <code>/v1/integration/event-replay</code>)</li>
</ul></li>
<li>Added optional field refId in the responses of place order, get order details using <code>client order id</code>, <code>order history</code>, <code>open orders</code>, <code>linked
orders</code> endpoints.</li>
<li>Secure Web Socket Updates:
a. In each event, <code>eventTime</code> will be in nanoseconds and type will be string.</li>
</ol>
<h2 id='28-05-2024'>28-05-2024</h2>
<ol>
<li>New Endpoints <br/></p>

<p><ul>
<li> Get Order ( GET <code>/v1/order?clientOrderId=abc</code>)<br/></li>
<li>Get Position ( GET <code>/v1/positions?positionId=abc</code>)<br/></li>
<li>Event Replay ( POST <code>/v1/integration/event-replay</code>): This is just endpoint, we&#39;re still deploying the changes.<br/>
<br/></li>
</ul></li>
<li>Secure Web Socket Updates:<br/>
a. Added new event for Funding Fee named <strong>fundingFee</strong></li>
</ol>
<h2 id='20-05-2024'>20-05-2024</h2>
<ol>
<li>Added <code>lockedMargin</code> field in the <code>place-order</code> API response</li>
</ol>
<h2 id='10-05-2024'>10-05-2024</h2>
<ol>
<li>New Endpoint:
INR Deposit and Withdraw History ( GET <code>/v1/integration/deposit-withdraw-history</code>)</li>
<li>New enums: <code>PaymentType</code>, <code>PaymentStatus</code></li>
<li>Added optional query params for pagination for the following endpoints</p>

<p><ul>
<li>Order History</li>
<li>Open Orders</li>
<li>Transaction History</li>
<li>Trade History</li>
</ul></li>
<li>Updated public key sharing under Authenticated endpoints.</li>
<li>Secure Web Socket Updates:</p>

<p><ul>
<li>Added eventTime field in all the events.</li>
<li>Updated response of order events.
In case of orderPartiallyFilled event, use filledAmount instead of cumQty for total filled
quantity.
c. New Events:</li>
<li>Margin Call (marginCallAlert)</li>
<li>Liquidation ( liquidationAlert)</li>
<li>Trade stream (newTrade)</li>
</ul></li>
</ol></p>

<h1 id='introduction'>Introduction</h1>

<p>Pi42 offers a suite of public-facing APIs designed to facilitate integration with various applications and systems, particularly within the domains it specializes in. Here is a high-level introduction to the key features and functionalities of Pi42&#39;s public-facing APIs:</p>

<ol>
<li><p><strong>Authentication and Authorization</strong>:</p>

<ul>
<li><strong>OAuth 2.0 Support</strong>: Pi42 APIs utilize OAuth 2.0 for secure authentication and authorization, ensuring that only authorized users and applications can access the data.</li>
<li><strong>API Keys</strong>: For simpler integrations, Pi42 also supports API keys, allowing developers to authenticate their requests with a unique key.</li>
</ul></li>
<br/>

<li><p><strong>Data Access and Management</strong>:</p>

<ul>
<li><strong>Data Retrieval</strong>: APIs provide endpoints for retrieving various types of data, such as user information, transaction history, and analytics reports.</li>
<li><strong>Data Insertion and Updates</strong>: Developers can use the APIs to insert new data or update existing records in the Pi42 system.</li>
<li><strong>Search and Filtering</strong>: Advanced search and filtering capabilities allow developers to query the data efficiently, using parameters like date ranges, status filters, and more.</li>
</ul></li>

<br/>
<li><p><strong>Analytics and Reporting</strong>:</p>

<ul>
<li><strong>Real-time Analytics</strong>: Access real-time analytics data, enabling applications to display up-to-the-minute information.</li>
<li><strong>Custom Reports</strong>: APIs allow the generation of custom reports based on specified criteria, providing flexibility in data analysis.</li>
</ul></li>
<br/>

<li><p><strong>Developer Resources</strong>:</p>

<ul>
<li><strong>Comprehensive Documentation</strong>: Detailed API documentation, including endpoint descriptions, request and response formats, error codes, and usage examples.</li>
</ul></li>

<br/>
<li><p><strong>Compliance and Security</strong>:</p>

<ul>
<li><strong>Data Encryption</strong>: All data transmitted via the APIs is encrypted to ensure security and privacy.</li>
<li><strong>Compliance</strong>: Pi42 APIs adhere to industry standards and regulations, such as GDPR making them suitable for use in regulated industries like finance.</li>
</ul></li>
</ol>

<h2 id='getting-started-with-pi42-apis'>Getting Started with Pi42 APIs</h2>

<p>APIs provided by Pi42 classifications ensure that only authorized users can access sensitive functionalities, while still allowing open access to non-sensitive information or system statuses.</p>

<h3 id='authenticated-apis'>Authenticated APIs</h3>

<p>The Authenticated endpoints require users to provide valid credentials before access is granted. These endpoints are secured, ensuring that only authorized users can interact with sensitive data or perform privileged operations. Authentication typically involves the use of tokens, API keys, or OAuth, which must be included in the request header. These endpoints are designed for operations that involve personal data, secure transactions, or actions that could impact the system&#39;s state or other users.</p>

<p>APIs that require trade permissions:</p>

<table>
<tr><td><code>/v1/order/place-order</code></td></tr>
<tr><td><code>/v1/order/delete-order</code></td></tr>
<tr><td><code>/v1/order/add-margin</code></td></tr>
<tr><td><code>/v1/order/reduce-margin</code></td></tr>
<tr><td><code>/v1/exchange/update/leverage</code></td></tr>
</table>

<h3 id='public-apis'>Public APIs</h3>

<p>The Public endpoints are accessible without any authentication, allowing open access to certain resources or information. These endpoints are designed to handle requests that do not require user identification or secure access, such as fetching general information, retrieving publicly available data, or providing status updates. While public, these endpoints are still subject to rate limiting and monitoring to prevent abuse or misuse of the system.</p>

<p>Endpoints which <strong>DO NOT</strong> require <code>api-key</code> and <code>signature</code> authentication:</p>

<table>
<tr>
<td><code>/v1/market/klines</code></td></tr>
<tr><td><code>/v1/market/depth</code></td></tr>
<tr><td><code>/v1/market/aggTrade</code></td></tr>
<tr><td><code>/v1/market/ticker24Hr</code></td></tr>
</table>

<aside class="notice"> 
Base URLs for: <br/>
- Authenticated endpoints: <code>https://fapi.pi42.com/ </code> <br/>
- Public endpoints: <code> https://api.pi42.com/ </code>
</aside>

<p>To begin using Pi42 Authenticated APIs, follow these steps:</p>

<ol>
<li><p>API Key Creation <br/>
Users can create an API key, which will be associated with a secret. The secret will be shown only once during the creation process.</p></li>
<li><p>Signature Generation <br/></p>

<ul>
<li> For each authenticated request, users need to generate a signature using their secret key. <br/></li>
<li>For GET requests: The data to be signed is the query string, which includes the timestamp and any other query parameters.<br/></li>
<li>For POST/PUT/DELETE requests: The data to be signed is the body of the request, which includes the timestamp, and any other
fields. <br/></li>
<li>The signature is generated by applying HMAC-SHA256 to the data (query string or body) using the user&#39;s secret key. <br/></li>
<li>The generated signature is sent in the request headers along with the API key. <br/></li>
</ul></li>
</ol>

<h2 id="get-request">getRequest Function</h2>

<p>The <code>getRequest</code> function sends a GET request to an API endpoint, handling both market and non-market endpoints differently. It adds a timestamp to the parameters for request uniqueness, generates a signature for authentication, and processes the response.</p>

<p>Sends a GET request to the specified endpoint with the given parameters:</p>

<ul>
<li>endpoint (string): The API endpoint to which the request is sent. <br/></li>
<li>params (Object, optional): Query parameters to include in the request. Defaults to an empty object.</li>
</ul>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="cm">/**
 * Sends a GET request to the specified endpoint with the given parameters.
 * 
 * @param {string} endpoint - The API endpoint to send the request to.
 * @param {Object} [params={}] - The query parameters to include in the request.
 * @returns {Promise&lt;Object&gt;} - The response data from the API.
 */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
    <span class="c1">// Add a timestamp to the parameters for request uniqueness</span>
    <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">().</span><span class="nx">toString</span><span class="p">();</span>
    <span class="nx">params</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">timestamp</span><span class="p">;</span>

    <span class="c1">// Determine if the endpoint is a market endpoint</span>
    <span class="kd">const</span> <span class="nx">isMarketEndpoint</span> <span class="o">=</span> <span class="nx">endpoint</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">"</span><span class="s2">/v1/market</span><span class="dl">"</span><span class="p">);</span>
    <span class="kd">let</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">""</span><span class="p">;</span>

    <span class="c1">// Construct the URL based on the endpoint type</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">isMarketEndpoint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">publicBaseUrl</span><span class="p">}${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">?</span><span class="p">${</span><span class="k">new</span> <span class="nx">URLSearchParams</span><span class="p">(</span><span class="nx">params</span><span class="p">).</span><span class="nx">toString</span><span class="p">()}</span><span class="s2">`</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Generate a signature for the request</span>
    <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">generateSignature</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="nx">apiSecret</span><span class="p">);</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// Send the GET request</span>
        <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span>
            <span class="nx">url</span><span class="p">,</span>
            <span class="o">!</span><span class="nx">isMarketEndpoint</span> <span class="p">?</span> <span class="p">{</span>
                <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
                    <span class="dl">"</span><span class="s2">api-key</span><span class="dl">"</span><span class="p">:</span> <span class="nx">apiKey</span><span class="p">,</span>
                    <span class="dl">"</span><span class="s2">signature</span><span class="dl">"</span><span class="p">:</span> <span class="nx">signature</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">}</span> <span class="p">:</span> <span class="p">{}</span>
        <span class="p">);</span>
        <span class="c1">// Log and return the response data</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Response:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Handle and log any errors that occur during the request</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span>
            <span class="dl">"</span><span class="s2">Error:</span><span class="dl">"</span><span class="p">,</span>
            <span class="nx">error</span><span class="p">.</span><span class="nx">response</span> <span class="p">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span> <span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id='response'>Response</h3>
<p>Returns: A Promise that resolves to the response data from the API.</p>

<p>Error Handling: If an error occurs during the request, it logs the error message or response data to the console.</p>

<h2 id="post-request">postRequest Function</h2>

<p>The function sends POST requests to an API endpoint, handling both authenticated and public requests based on the endpoint URL.</p>

<ul>
<li>endpoint (string): The API endpoint to which the POST request is sent.</li>
<li>params (object): The parameters to be included in the POST request body. This is optional and defaults to an empty object.</li>
</ul>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// Generic POST request function</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">postRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">().</span><span class="nx">toString</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">isMarketEndpoint</span> <span class="o">=</span> <span class="nx">endpoint</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">"</span><span class="s2">/v1/market</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">baseUrlToUse</span> <span class="o">=</span> <span class="nx">isMarketEndpoint</span> <span class="p">?</span> <span class="nx">publicBaseUrl</span> <span class="p">:</span> <span class="nx">baseUrl</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrlToUse</span><span class="p">}${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isMarketEndpoint</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">params</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">timestamp</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">crypto</span>
    <span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">"</span><span class="s2">sha256</span><span class="dl">"</span><span class="p">,</span> <span class="nx">apiSecret</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">params</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span>
      <span class="nx">url</span><span class="p">,</span>
      <span class="nx">params</span><span class="p">,</span>
      <span class="nx">isMarketEndpoint</span>
        <span class="p">?</span> <span class="p">{}</span>
        <span class="p">:</span> <span class="p">{</span>
            <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
              <span class="dl">"</span><span class="s2">api-key</span><span class="dl">"</span><span class="p">:</span> <span class="nx">apiKey</span><span class="p">,</span>
              <span class="na">signature</span><span class="p">:</span> <span class="nx">signature</span><span class="p">,</span>
            <span class="p">},</span>
          <span class="p">}</span>
    <span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Response:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span>
      <span class="dl">"</span><span class="s2">Error:</span><span class="dl">"</span><span class="p">,</span>
      <span class="nx">error</span><span class="p">.</span><span class="nx">response</span> <span class="p">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span> <span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span>
    <span class="p">);</span>
    <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span> <span class="c1">// Optional: re-throw the error if you want to handle it further up the call stack</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id='response-2'>Response</h3>
<p><code>console.log(&quot;Response:&quot;, response.data);</code> <br/>
Logs the response data to the console. <br/></p>

<p><code>return response.data;</code> <br/>
Returns the response data for further use.<br/></p>

<h2 id="put-request">putRequest Function</h2>

<p>This function, <code>putRequest</code>, is an asynchronous JavaScript function designed to send a signed <code>PUT</code> HTTP request to a specified API endpoint. Here&#39;s a breakdown of its components and behavior:</p>

<ul>
<li>endpoint: A string representing the API endpoint to which the request will be sent. It is appended to a base URL to form the complete request URL.</li>
<li>params: An optional object containing the parameters to be included in the request body. If no parameters are provided, an empty object is used by default.</li>
</ul>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">putRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">().</span><span class="nx">toString</span><span class="p">();</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">timestamp</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">crypto</span>
    <span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">"</span><span class="s2">sha256</span><span class="dl">"</span><span class="p">,</span> <span class="nx">apiSecret</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">params</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>

  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">api-key</span><span class="dl">"</span><span class="p">:</span> <span class="nx">apiKey</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">signature</span><span class="dl">"</span><span class="p">:</span> <span class="nx">signature</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">});</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Response:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span>
      <span class="dl">"</span><span class="s2">Error:</span><span class="dl">"</span><span class="p">,</span>
      <span class="nx">error</span><span class="p">.</span><span class="nx">response</span> <span class="p">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span> <span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id='response-3'>Response</h3>
<p>If the request is successful, the response data is logged to the console and returned by the function.</p>

<h2 id="delete-request">deleteRequest Function</h2>

<p>This deleteRequest function is an asynchronous JavaScript function designed to send a signed DELETE HTTP request to a specified API endpoint. Below is a detailed explanation of its components and behavior:</p>

<ul>
<li>endpoint: A string representing the API endpoint to which the DELETE request will be sent. It is appended to a base URL to form the complete request URL.</li>
<li>params: An optional object containing the parameters to be included in the request. If no parameters are provided, an empty object is used by default.</li>
</ul>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">axios</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">deleteRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{})</span> <span class="p">{</span>
  <span class="c1">// Generate a timestamp and add it to the params</span>
  <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">().</span><span class="nx">toString</span><span class="p">();</span>
  <span class="nx">params</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">timestamp</span><span class="p">;</span>

  <span class="c1">// Create a cryptographic signature using HMAC with SHA-256</span>
  <span class="kd">const</span> <span class="nx">signature</span> <span class="o">=</span> <span class="nx">crypto</span>
    <span class="p">.</span><span class="nx">createHmac</span><span class="p">(</span><span class="dl">"</span><span class="s2">sha256</span><span class="dl">"</span><span class="p">,</span> <span class="nx">apiSecret</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">params</span><span class="p">))</span>
    <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">);</span>

  <span class="c1">// Construct the full request URL</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">baseUrl</span><span class="p">}${</span><span class="nx">endpoint</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Send the DELETE request using axios</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">axios</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">api-key</span><span class="dl">"</span><span class="p">:</span> <span class="nx">apiKey</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">signature</span><span class="dl">"</span><span class="p">:</span> <span class="nx">signature</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="na">data</span><span class="p">:</span> <span class="nx">params</span><span class="p">,</span>
    <span class="p">});</span>

    <span class="c1">// Log and return the response data if the request is successful</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Response:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle and log any errors that occur during the request</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span>
      <span class="dl">"</span><span class="s2">Error:</span><span class="dl">"</span><span class="p">,</span>
      <span class="nx">error</span><span class="p">.</span><span class="nx">response</span> <span class="p">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span> <span class="p">:</span> <span class="nx">error</span><span class="p">.</span><span class="nx">message</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h1 id='rate-limits'>API Rate Limits</h1>

<p>Rate limits are mechanisms used to control the frequency of requests that can be made to an API. These rate limits are essential for maintaining optimal performance and avoiding server overloads, ensuring a smooth and reliable user experience across all API interactions.</p>

<p>Different endpoints may have varying rate limits depending on their purpose and the resources they consume.</p>

<table><thead>
<tr>
<th>Endpoint</th>
<th>Interval</th>
<th>Limit</th>
</tr>
</thead><tbody>
<tr>
<td><code>v1/order/place-order</code></td>
<td>1 second (1s)</td>
<td>20 requests</td>
</tr>
<tr>
<td><code>v1/order/delete-order</code></td>
<td>10 seconds (10s)</td>
<td>5 requests </td>
</tr>
<tr>
<td>All other endpoints</td>
<td>10 seconds (10s)</td>
<td>10 requests </td>
</tr>
</tbody></table>


<h1 id='orders'>Orders</h1>

<h2 id="place-order">Place an Order </h2>

<p><code>POST /v1/order/place-order</code></p>

<p>Place an order (either a market order or a limit order) on Pi42&#39;s trading platform. It allows users to submit an order to buy or sell a specific asset.</p>

<aside class="notice"> Note:
<ul>
<li>Price is compulsory to place a limit order.</li>
<li>To successfully place an order from a position, you need to pass the <code>positionId</code> in the request payload, which can be obtained calling the
<a href="#get-positions">Get Positions API</a></li>
</ul>
</aside>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">placeOrder</span><span class="p">(</span><span class="nx">orderType</span><span class="p">,</span> <span class="nx">quantity</span> <span class="o">=</span> <span class="mi">38</span><span class="p">,</span> <span class="nx">price</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Validate orderType</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="dl">"</span><span class="s2">MARKET</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">LIMIT</span><span class="dl">"</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">orderType</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Invalid order type. Must be 'MARKET' or 'LIMIT'.</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Validate quantity</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">quantity</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Quantity must be greater than 0.</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">placeType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ORDER_FORM</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">quantity</span><span class="p">:</span> <span class="nx">quantity</span><span class="p">,</span> <span class="c1">// Dynamically set quantity</span>
    <span class="na">side</span><span class="p">:</span> <span class="dl">"</span><span class="s2">BUY</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">symbol</span><span class="p">:</span> <span class="dl">"</span><span class="s2">GRTINR</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">reduceOnly</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">marginAsset</span><span class="p">:</span> <span class="dl">"</span><span class="s2">INR</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="nx">orderType</span><span class="p">,</span> <span class="c1">// Set the order type dynamically</span>
  <span class="p">};</span>

  <span class="c1">// Add additional parameters if the order is a LIMIT order</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">orderType</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">LIMIT</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">price</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">price</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Price must be specified and greater than 0 for LIMIT orders.</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">params</span><span class="p">.</span><span class="nx">price</span> <span class="o">=</span> <span class="nx">price</span><span class="p">;</span> <span class="c1">// Dynamically set price for LIMIT orders</span>
  <span class="p">}</span>

  <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/order/place-order</span><span class="dl">"</span><span class="p">;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Call the postRequest function</span>
    <span class="kd">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">postRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Failed to place order:</span><span class="dl">"</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
    <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Example usage for market order</span>
<span class="nx">placeOrder</span><span class="p">(</span><span class="dl">"</span><span class="s2">MARKET</span><span class="dl">"</span><span class="p">);</span>

<span class="c1">// Example usage for limit order with price</span>
<span class="nx">placeOrder</span><span class="p">(</span><span class="dl">"</span><span class="s2">LIMIT</span><span class="dl">"</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mf">11.9</span><span class="p">);</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">place_order</span><span class="p">():</span>
    <span class="c1"># Generate the current timestamp in milliseconds
</span>    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="c1"># Define the order parameters
</span>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>        <span class="c1"># Current timestamp in milliseconds
</span>        <span class="s">'placeType'</span><span class="p">:</span> <span class="s">'ORDER_FORM'</span><span class="p">,</span>     <span class="c1"># Type of order placement, e.g., 'ORDER_FORM'
</span>        <span class="s">'quantity'</span><span class="p">:</span> <span class="mf">0.002</span><span class="p">,</span>             <span class="c1"># Quantity of the asset to trade
</span>        <span class="s">'side'</span><span class="p">:</span> <span class="s">'BUY'</span><span class="p">,</span>                 <span class="c1"># Order side, either 'BUY' or 'SELL'
</span>        <span class="s">'symbol'</span><span class="p">:</span> <span class="s">'BTCUSDT'</span><span class="p">,</span>           <span class="c1"># Trading pair, e.g., Bitcoin to USDT
</span>        <span class="s">'type'</span><span class="p">:</span> <span class="s">'MARKET'</span><span class="p">,</span>              <span class="c1"># Order type, either 'MARKET' or 'LIMIT'
</span>        <span class="s">'reduceOnly'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>           <span class="c1"># Whether to reduce an existing position only
</span>        <span class="s">'marginAsset'</span><span class="p">:</span> <span class="s">'INR'</span><span class="p">,</span>          <span class="c1"># The asset used as margin (INR in this case)
</span>        <span class="s">'deviceType'</span><span class="p">:</span> <span class="s">'WEB'</span><span class="p">,</span>           <span class="c1"># Device type (e.g., WEB, MOBILE)
</span>        <span class="s">'userCategory'</span><span class="p">:</span> <span class="s">'EXTERNAL'</span><span class="p">,</span>    <span class="c1"># User category (e.g., EXTERNAL, INTERNAL)
</span>        <span class="s">'price'</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>                <span class="c1"># Price for the limit order (included here but irrelevant for market orders)
</span>    <span class="p">}</span>

    <span class="c1"># Convert the parameters to a JSON string to sign
</span>    <span class="n">data_to_sign</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">':'</span><span class="p">))</span>

    <span class="c1"># Generate the signature for authentication
</span>    <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">data_to_sign</span><span class="p">)</span>

    <span class="c1"># Define the headers including the API key and the signature
</span>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
        <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Send the POST request to place the order
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">/v1/order/place-order'</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="c1"># Raise an HTTPError if the response status is 4xx or 5xx
</span>        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="c1"># Parse the JSON response data
</span>        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># Print the success message with the order details
</span>        <span class="k">print</span><span class="p">(</span><span class="s">'Order placed successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="c1"># Handle HTTP errors specifically
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Handle any other unexpected errors
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div>
<table style="border-collapse: collapse;">
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Type</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>orderType</td>
      <td>string</td>
      <td>Yes</td>
      <td>The type of the order. It can be "MARKET" or "LIMIT".</td>
    </tr>
    <tr>
      <td>quantity</td>
      <td>number</td>
      <td>No</td>
      <td>The amount of the asset to be ordered. Specify the desired quantity.</td>
    </tr>
    <tr>
      <td>price</td>
      <td>number</td>
      <td>Conditional</td>
      <td>The price at which to place the LIMIT order. Must be specified if orderType is "LIMIT".</td>
    </tr>
    <tr>
      <td>placeType</td>
      <td>string</td>
      <td>Yes</td>
      <td>Fixed value "ORDER_FORM". Indicates the type of order placement.</td>
    </tr>
    <tr>
      <td>side</td>
      <td>string</td>
      <td>Yes</td>
      <td>The side of the order, which is "BUY" in this case.</td>
    </tr>
    <tr>
      <td>symbol</td>
      <td>string</td>
      <td>Yes</td>
      <td>The trading pair symbol, for example, "GRTINR".</td>
    </tr>
    <tr>
      <td>reduceOnly</td>
      <td>boolean</td>
      <td>No</td>
      <td>Indicates whether the order should only reduce the position. Default is false.</td>
    </tr>
    <tr>
      <td>marginAsset</td>
      <td>string</td>
      <td>Yes</td>
      <td>The asset used for margin, such as "INR".</td>
    </tr>
    <tr>
      <td>type</td>
      <td>string</td>
      <td>Yes</td>
      <td>The type of order to place, based on the value of <code>orderType</code>.</td>
    </tr>
        <tr>
      <td>takeProfitPrice</td>
      <td>number</td>
      <td>No</td>
      <td>Price at which take profit order should be executed.</td>
    </tr>
        <tr>
      <td>stopLossPrice</td>
      <td>number</td>
      <td>No</td>
      <td>Price at which stop loss order should be executed.</td>
    </tr>
  </tbody>
</table>

<h3 id='response'>Response</h3>

<p>The response parameters are described below:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">#</span><span class="w"> </span><span class="err">Response</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"clientOrderId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"19db8caf3cd3e5a08cfa-6895-ext"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-13T08:19:18.029Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"symbol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTCUSDT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"contractType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PERPETUAL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MARKET"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"side"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BUY"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mi">58002</span><span class="p">,</span><span class="w">
    </span><span class="nl">"orderAmount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.003</span><span class="p">,</span><span class="w">
    </span><span class="nl">"filledAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"availableBalance"</span><span class="p">:</span><span class="w"> </span><span class="mf">8564.64</span><span class="p">,</span><span class="w">
    </span><span class="nl">"linkId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"19db8caf3cd3e5a08cfa-6895-ext"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"linkType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ORDER"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"subType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PRIMARY"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"placeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ORDER_FORM"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lockedMargin"</span><span class="p">:</span><span class="w"> </span><span class="mf">19.5274</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTC"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quoteAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USDT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"marginAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lockedMarginInMarginAsset"</span><span class="p">:</span><span class="w"> </span><span class="mf">1698.88</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>clientOrderId</strong></td>
      <td>Unique identifier for the client order (<code>19db8caf3cd3e5a08cfa-6895-ext</code>).</td>
    </tr>
    <tr>
      <td><strong>time</strong></td>
      <td>Timestamp when the order was placed (<code>2024-09-13T08:19:18.029Z</code>).</td>
    </tr>
    <tr>
      <td><strong>symbol</strong></td>
      <td>The trading pair for the order (<code>BTCUSDT</code>), indicating Bitcoin (BTC) traded against USDT (Tether).</td>
    </tr>
    <tr>
      <td><strong>contractType</strong></td>
      <td>The type of contract for the order (<code>PERPETUAL</code>), indicating a perpetual futures contract.</td>
    </tr>
    <tr>
      <td><strong>type</strong></td>
      <td>The type of order (<code>MARKET</code>), indicating a market order.</td>
    </tr>
    <tr>
      <td><strong>side</strong></td>
      <td>The side of the order (<code>BUY</code>).</td>
    </tr>
    <tr>
      <td><strong>price</strong></td>
      <td>The price at which the order is to be executed (<code>58002 USDT</code>).</td>
    </tr>
    <tr>
      <td><strong>orderAmount</strong></td>
      <td>The amount of the order (<code>0.003 BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>filledAmount</strong></td>
      <td>The amount of the order that has been filled (<code>0</code>, indicating no amount has been filled yet).</td>
    </tr>
    <tr>
      <td><strong>availableBalance</strong></td>
      <td>The available balance for the order (<code>8564.64 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>linkId</strong></td>
      <td>Link identifier associated with the order (<code>19db8caf3cd3e5a08cfa-6895-ext</code>).</td>
    </tr>
    <tr>
      <td><strong>linkType</strong></td>
      <td>The type of link for the order (<code>ORDER</code>).</td>
    </tr>
    <tr>
      <td><strong>subType</strong></td>
      <td>Subtype of the order (<code>PRIMARY</code>).</td>
    </tr>
    <tr>
      <td><strong>placeType</strong></td>
      <td>The method used to place the order (<code>ORDER_FORM</code>).</td>
    </tr>
    <tr>
      <td><strong>lockedMargin</strong></td>
      <td>The amount of margin locked for the order (<code>19.5274 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>baseAsset</strong></td>
      <td>The base asset being traded (<code>BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>quoteAsset</strong></td>
      <td>The currency used for the transaction (<code>USDT</code>).</td>
    </tr>
    <tr>
      <td><strong>marginAsset</strong></td>
      <td>The asset used for margin (<code>INR</code>).</td>
    </tr>
    <tr>
      <td><strong>lockedMarginInMarginAsset</strong></td>
      <td>The amount of margin locked in the margin asset (<code>1698.88 INR</code>).</td>
    </tr>
  </tbody>
</table>

<h2 id="add-margin"> Add Margin </h2>

<p><code>POST /v1/order/add-margin</code></p>

<p>Add margin to a specific position. It requires a unique position ID and the amount of margin to be added. This operation helps in increasing the margin available for a given position, which can be used for trading or managing positions.</p>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">addMargin</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Define the API endpoint for adding margin</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/order/add-margin</span><span class="dl">"</span><span class="p">;</span>

    <span class="c1">// Define the fixed values for positionId and amount</span>
    <span class="kd">const</span> <span class="nx">positionId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">18c6c979-b089-4e67-b627-4c2072d0d5cb</span><span class="dl">"</span><span class="p">;</span>  <span class="c1">// Unique identifier for the position</span>
    <span class="kd">const</span> <span class="nx">amount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// The amount of margin to be added</span>

    <span class="c1">// Prepare request payload</span>
    <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">positionId</span><span class="p">:</span> <span class="nx">positionId</span><span class="p">,</span>  <span class="c1">// ID of the position to which margin is being added</span>
        <span class="na">amount</span><span class="p">:</span> <span class="nx">amount</span><span class="p">,</span>          <span class="c1">// Amount of margin to add</span>
    <span class="p">};</span>

    <span class="c1">// Call the postRequest function to send the POST request to the API</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">postRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">add_margin</span><span class="p">():</span>
    <span class="n">position_id</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the positionId: "</span><span class="p">)</span>
    <span class="n">amount_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the amount: "</span><span class="p">)</span>

    <span class="n">add_margin_url</span> <span class="o">=</span> <span class="s">"https://fapi.pi42.com/v1/order/add-margin"</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amount_input</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount_input</span><span class="p">)</span>

    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'positionId'</span><span class="p">:</span> <span class="n">position_id</span><span class="p">,</span>
        <span class="s">'amount'</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
        <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
    <span class="p">}</span>

    <span class="n">data_to_sign</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">':'</span><span class="p">))</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">data_to_sign</span><span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">add_margin_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Margin added successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>positionId</td>
            <td>string</td>
            <td>Yes</td>
            <td>Unique identifier for the position to which margin is being added</td>
        </tr>
        <tr>
            <td>amount</td>
            <td>number</td>
            <td>Yes</td>
            <td>Amount of margin to be added to the specified position</td>
        </tr>
    </tbody>
</table>

<aside class="notice">
The required <code>positionId</code> can be obtained calling the <a href="#get-positions">Get Positions API</a>
</aside>

<h3 id='response-2'>Response</h3>

<p>The response parameters are described below:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">#</span><span class="w"> </span><span class="err">Response</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"lockedBalance"</span><span class="p">:</span><span class="w"> </span><span class="mi">870</span><span class="p">,</span><span class="w">
  </span><span class="nl">"withdrawableBalance"</span><span class="p">:</span><span class="w"> </span><span class="mf">9393.52</span><span class="p">,</span><span class="w">
  </span><span class="nl">"asset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Margin added successfully"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>lockedBalance</strong></td>
      <td>The amount of balance that is locked and cannot be withdrawn (870 INR).</td>
    </tr>
    <tr>
      <td><strong>withdrawableBalance</strong></td>
      <td>The amount of balance available for withdrawal (9393.52 INR).</td>
    </tr>
    <tr>
      <td><strong>asset</strong></td>
      <td>The asset or currency being used (INR).</td>
    </tr>
    <tr>
      <td><strong>message</strong></td>
      <td>A confirmation message indicating that margin was added successfully.</td>
    </tr>
  </tbody>
</table>

<h2 id="reduce-margin">Reduce Margin</h2>

<p><code>POST /v1/order/reduce-margin</code></p>

<p>Reduce the margin on an existing trading position.</p>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">reduceMargin</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Define the API endpoint for reducing margin</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/order/reduce-margin</span><span class="dl">"</span><span class="p">;</span>

    <span class="c1">// Define the fixed values for positionId and amount</span>
    <span class="kd">const</span> <span class="nx">positionId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">18c6c979-b089-4e67-b627-4c2072d0d5cb</span><span class="dl">"</span><span class="p">;</span>  <span class="c1">// Unique identifier for the position</span>
    <span class="kd">const</span> <span class="nx">amount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// The amount of margin to be reduced</span>

    <span class="c1">// Prepare request payload</span>
    <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">positionId</span><span class="p">:</span> <span class="nx">positionId</span><span class="p">,</span>  <span class="c1">// ID of the position from which margin is being reduced</span>
        <span class="na">amount</span><span class="p">:</span> <span class="nx">amount</span><span class="p">,</span>          <span class="c1">// Amount of margin to reduce</span>
    <span class="p">};</span>

    <span class="c1">// Call the postRequest function to send the POST request to the API</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">postRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">reduce_margin</span><span class="p">():</span>
    <span class="c1"># Collect position ID and amount to reduce from user input
</span>    <span class="n">position_id</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the positionId: "</span><span class="p">)</span>
    <span class="n">amountInput</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the amount to reduce: "</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Convert input to integer or float as necessary
</span>        <span class="n">amount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">amountInput</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
        <span class="n">amount</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amountInput</span><span class="p">)</span>

    <span class="c1"># Generate current timestamp in milliseconds
</span>    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="c1"># Prepare the request payload (JSON)
</span>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'positionId'</span><span class="p">:</span> <span class="n">position_id</span><span class="p">,</span>
        <span class="s">'amount'</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
        <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
    <span class="p">}</span>

    <span class="c1"># Convert the payload to a JSON string for signature
</span>    <span class="n">data_to_sign</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">':'</span><span class="p">))</span>

    <span class="c1"># Generate the signature using a helper function
</span>    <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">data_to_sign</span><span class="p">)</span>

    <span class="c1"># Set the headers for the POST request
</span>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span>
    <span class="p">}</span>

    <span class="c1"># Construct the full API endpoint URL
</span>    <span class="n">reduce_margin_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">/v1/order/reduce-margin"</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Send the POST request to reduce margin
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">reduce_margin_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raises an error for HTTP responses with 4xx/5xx status codes
</span>        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Margin reduced successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>positionId</td>
            <td>string</td>
            <td>Yes</td>
            <td>Unique identifier for the position from which margin is being reduced</td>
        </tr>
        <tr>
            <td>amount</td>
            <td>number</td>
            <td>Yes</td>
            <td>Amount of margin to reduce from the specified position</td>
        </tr>
    </tbody>
</table>

<aside class="notice">
The required <code>positionId</code> can be obtained calling the <a href="#get-positions">Get Positions API</a>
</aside>

<h3 id='response-3'>Response</h3>

<p>The JSON body returned in the response is as follows:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="w">
</span><span class="err">#</span><span class="w"> </span><span class="err">Response</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"lockedBalance"</span><span class="p">:</span><span class="w"> </span><span class="mi">870</span><span class="p">,</span><span class="w">
    </span><span class="nl">"withdrawableBalance"</span><span class="p">:</span><span class="w"> </span><span class="mf">9393.52</span><span class="p">,</span><span class="w">
    </span><span class="nl">"asset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Margin reduced successfully"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>lockedBalance</strong></td>
      <td>The amount of balance that is locked and cannot be withdrawn (870 INR).</td>
    </tr>
    <tr>
      <td><strong>withdrawableBalance</strong></td>
      <td>The amount of balance available for withdrawal (9393.52 INR).</td>
    </tr>
    <tr>
      <td><strong>asset</strong></td>
      <td>The asset or currency being used (INR).</td>
    </tr>
    <tr>
      <td><strong>message</strong></td>
      <td>A confirmation message indicating that margin was reduced successfully.</td>
    </tr>
  </tbody>
</table>

<h2 id="get-open-orders">Get Open Orders</h2>

<p><code>GET /v1/order/open-orders</code></p>

<p>Retrieves the open orders for a given account. It supports filtering results based on optional parameters such as page size, sorting order, and timestamps. The symbol parameter can be used to filter the results to a specific trading pair. <br/>This endpoint is useful for fetching the current active orders and managing them accordingly.</p>

<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">get_open_orders</span><span class="p">():</span>
<span class="c1"># Generate the current timestamp
</span>    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

<span class="c1"># Prepare parameters with the current timestamp
</span>    <span class="n">params</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"timestamp=</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s">"</span>

<span class="c1"># Generate the signature using the current timestamp
</span>    <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

<span class="c1"># Prepare headers
</span>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
    <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">open_orders_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">/v1/order/open-orders"</span>
    <span class="k">try</span><span class="p">:</span>

<span class="c1"># Send GET request to fetch open orders with the timestamp parameter
</span>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">open_orders_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">})</span>
    <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span> <span class="c1"># Raises an error for bad HTTP responses
</span>    <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Open orders fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">getOpenOrders</span><span class="p">()</span> <span class="p">{</span>
<span class="kd">const</span> <span class="nx">pageSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">sortOrder</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">startTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1696425435000</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">endTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1725451568979</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">symbol</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCUSDT</span><span class="dl">"</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
 <span class="c1">// Optional Params</span>
    <span class="na">pageSize</span><span class="p">:</span> <span class="nx">pageSize</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
    <span class="na">sortOrder</span><span class="p">:</span> <span class="nx">sortOrder</span><span class="p">,</span>
    <span class="na">startTimestamp</span><span class="p">:</span> <span class="nx">startTimestamp</span><span class="p">,</span>
    <span class="na">endTimestamp</span><span class="p">:</span> <span class="nx">endTimestamp</span><span class="p">,</span>
    <span class="na">symbol</span><span class="p">:</span> <span class="nx">symbol</span><span class="p">,</span>
    <span class="p">};</span>

<span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/order/open-orders</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Your endpoint for fetching open orders</span>

<span class="c1">// Call the postRequest function</span>
<span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>pageSize</td>
            <td>string</td>
            <td>No</td>
            <td>The number of results to return per page</td>
        </tr>
        <tr>
            <td>sortOrder</td>
            <td>string</td>
            <td>No</td>
            <td>The sorting order for the results (e.g., "asc" or "desc")</td>
        </tr>
        <tr>
            <td>startTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The start timestamp (in milliseconds) for filtering open orders</td>
        </tr>
        <tr>
            <td>endTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The end timestamp (in milliseconds) for filtering open orders</td>
        </tr>
        <tr>
            <td>symbol</td>
            <td>string</td>
            <td>No</td>
            <td>The trading pair symbol to filter the orders (e.g., BTCUSDT)</td>
        </tr>
    </tbody>
</table>

<h3 id='response-4'>Response</h3>

<p>The response parameters are described below:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"clientOrderId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ccef6a84a5cf6a463353-6238-ext"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-13T07:57:15.305Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"symbol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTCINR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"contractType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PERPETUAL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MARKET"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"side"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BUY"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mi">5170418</span><span class="p">,</span><span class="w">
    </span><span class="nl">"orderAmount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.002</span><span class="p">,</span><span class="w">
    </span><span class="nl">"filledAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"linkId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ccef6a84a5cf6a463353-6238-ext"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"linkType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ORDER"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"subType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PRIMARY"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"placeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ORDER_FORM"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTC"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quoteAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>clientOrderId</strong></td>
      <td>Unique identifier for the client's order (<code>ccef6a84a5cf6a463353-6238-ext</code>).</td>
    </tr>
    <tr>
      <td><strong>time</strong></td>
      <td>Timestamp when the order was placed (<code>2024-09-13T07:57:15.305Z</code>).</td>
    </tr>
    <tr>
      <td><strong>symbol</strong></td>
      <td>Trading pair involved (<code>BTCINR</code>), indicating Bitcoin (BTC) traded against Indian Rupees (INR).</td>
    </tr>
    <tr>
      <td><strong>contractType</strong></td>
      <td>Type of contract (<code>PERPETUAL</code>), suggests a perpetual futures contract.</td>
    </tr>
    <tr>
      <td><strong>type</strong></td>
      <td>The order type (<code>MARKET</code>), meaning the order will be executed immediately at the current market price.</td>
    </tr>
    <tr>
      <td><strong>side</strong></td>
      <td>Indicates whether the order is to buy or sell (<code>BUY</code>).</td>
    </tr>
    <tr>
      <td><strong>price</strong></td>
      <td>The price per unit of Bitcoin at the time the order was placed (<code>5170418 INR</code> per BTC).</td>
    </tr>
    <tr>
      <td><strong>orderAmount</strong></td>
      <td>The amount of Bitcoin to be purchased (<code>0.002</code> BTC).</td>
    </tr>
    <tr>
      <td><strong>filledAmount</strong></td>
      <td>Amount of the order that has been filled so far (<code>0</code>, indicating it hasn't been executed yet).</td>
    </tr>
    <tr>
      <td><strong>linkId</strong></td>
      <td>Additional reference that ties this order to a broader system or linked entities (<code>ccef6a84a5cf6a463353-6238-ext</code>).</td>
    </tr>
    <tr>
      <td><strong>linkType</strong></td>
      <td>The type of link (<code>ORDER</code>).</td>
    </tr>
    <tr>
      <td><strong>subType</strong></td>
      <td>Order classification (<code>PRIMARY</code>), indicating the main order type.</td>
    </tr>
    <tr>
      <td><strong>placeType</strong></td>
      <td>Describes where the order was placed from (<code>ORDER_FORM</code>).</td>
    </tr>
    <tr>
      <td><strong>baseAsset</strong></td>
      <td>The asset being bought (Bitcoin).</td>
    </tr>
    <tr>
      <td><strong>quoteAsset</strong></td>
      <td>The currency used for the transaction (INR).</td>
    </tr>
  </tbody>
</table>

<h2 id="get-order-history">Get Order History</h2>

<p><code>GET /v1/order/order-history</code></p>

<p>Provides historical order data for a given account.</p>

<p>It supports optional filtering by page size, sorting order, and timestamps to narrow down the results. The symbol parameter allows filtering the results to a specific trading pair.</p>

<p>This endpoint is helpful for reviewing past orders and analyzing historical trading activity.</p>

<div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># Function to fetch and display order history
</span><span class="k">def</span> <span class="nf">order_history</span><span class="p">():</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">order_history_url</span> <span class="o">=</span> <span class="s">"https://fapi.pi42.com/v1/order/order-history"</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">'sortOrder'</span><span class="p">:</span> <span class="s">'desc'</span><span class="p">,</span>
<span class="s">'pageSize'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
 <span class="p">}</span>

<span class="n">query_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"sortOrder=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'sortOrder'</span><span class="p">]</span><span class="si">}</span><span class="s">&amp;pageSize=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'pageSize'</span><span class="p">]</span><span class="si">}</span><span class="s">&amp;timestamp=
</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'timestamp'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span>

<span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">query_string</span><span class="p">)</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
<span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">try</span><span class="p">:</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">order_history_url</span><span class="si">}</span><span class="s">?</span><span class="si">{</span><span class="n">query_string</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Order history fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">//Get Order History</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">getOrderHistory</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">pageSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">sortOrder</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">startTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1696425435000</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">endTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1725451568979</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">symbol</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCUSDT</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// Optional Params</span>
    <span class="na">pageSize</span><span class="p">:</span> <span class="nx">pageSize</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
    <span class="na">sortOrder</span><span class="p">:</span> <span class="nx">sortOrder</span><span class="p">,</span>
    <span class="na">startTimestamp</span><span class="p">:</span> <span class="nx">startTimestamp</span><span class="p">,</span>
    <span class="na">endTimestamp</span><span class="p">:</span> <span class="nx">endTimestamp</span><span class="p">,</span>
    <span class="na">symbol</span><span class="p">:</span> <span class="nx">symbol</span><span class="p">,</span>
  <span class="p">};</span>
  <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/order/order-history</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Your endpoint for fetching order history</span>
  <span class="c1">// Call the postRequest function</span>
  <span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>pageSize</td>
            <td>string</td>
            <td>No</td>
            <td>The number of results to return per page</td>
        </tr>
        <tr>
            <td>sortOrder</td>
            <td>string</td>
            <td>No</td>
            <td>The sorting order for the results (e.g., "asc" or "desc")</td>
        </tr>
        <tr>
            <td>startTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The start timestamp (in milliseconds) for filtering order history</td>
        </tr>
        <tr>
            <td>endTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The end timestamp (in milliseconds) for filtering order history</td>
        </tr>
        <tr>
            <td>symbol</td>
            <td>string</td>
            <td>No</td>
            <td>The trading pair symbol to filter the orders (e.g., BTCUSDT)</td>
        </tr>
    </tbody>
</table>

<h3 id='response-5'>Response</h3>

<p>The details of the JSON object returned in the response body are as follows:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"clientOrderId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c707985129f41a13ab40-6238-ext"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"updatedAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-13T10:48:57.630Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"symbol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTCINR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MARKET"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"isIsolated"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"side"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SELL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5182995"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"avgPrice"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5182656"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"origQty"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10365.31"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"cumQty"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"executedQty"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.002"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"reduceOnly"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FILLED"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"leverage"</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w">
    </span><span class="nl">"subType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PRIMARY"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"stopPrice"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lockedMargin"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lockedMarginInMarginAsset"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"marginAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"contractType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PERPETUAL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"iconUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://storage.googleapis.com/pi42-dev-static/contract-icons/btc.png"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quoteAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTC"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"leveragedQty"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.002</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>clientOrderId</strong></td>
      <td>Unique identifier for the client's order (<code>c707985129f41a13ab40-6238-ext</code>).</td>
    </tr>
    <tr>
      <td><strong>updatedAt</strong></td>
      <td>The timestamp when the order was last updated (<code>2024-09-13T10:48:57.630Z</code>).</td>
    </tr>
    <tr>
      <td><strong>symbol</strong></td>
      <td>The trading pair involved (<code>BTCINR</code>), indicating Bitcoin (BTC) traded against Indian Rupees (INR).</td>
    </tr>
    <tr>
      <td><strong>type</strong></td>
      <td>The order type (<code>MARKET</code>), meaning the order was executed at the current market price.</td>
    </tr>
    <tr>
      <td><strong>isIsolated</strong></td>
      <td>Indicates whether the order is isolated (<code>true</code>), meaning it's an isolated margin trade.</td>
    </tr>
    <tr>
      <td><strong>side</strong></td>
      <td>Indicates whether the order is to buy or sell (<code>SELL</code>).</td>
    </tr>
    <tr>
      <td><strong>price</strong></td>
      <td>The price per unit of Bitcoin at the time the order was placed (<code>5182995 INR</code> per BTC).</td>
    </tr>
    <tr>
      <td><strong>avgPrice</strong></td>
      <td>The average price at which the order was executed (<code>5182656 INR</code> per BTC).</td>
    </tr>
    <tr>
      <td><strong>origQty</strong></td>
      <td>The original quantity in INR before conversion to BTC (<code>10365.31</code> INR).</td>
    </tr>
    <tr>
      <td><strong>cumQty</strong></td>
      <td>The cumulative amount of Bitcoin executed so far (<code>0.002</code> BTC).</td>
    </tr>
    <tr>
      <td><strong>executedQty</strong></td>
      <td>The total executed quantity of the order (<code>0.002</code> BTC).</td>
    </tr>
    <tr>
      <td><strong>reduceOnly</strong></td>
      <td>A flag indicating if the order is only to reduce an existing position (<code>false</code>).</td>
    </tr>
    <tr>
      <td><strong>status</strong></td>
      <td>The current status of the order (<code>FILLED</code>), meaning the order is completely executed.</td>
    </tr>
    <tr>
      <td><strong>leverage</strong></td>
      <td>The leverage applied to the trade (<code>25x</code>).</td>
    </tr>
    <tr>
      <td><strong>subType</strong></td>
      <td>The order classification (<code>PRIMARY</code>), indicating the main order type.</td>
    </tr>
    <tr>
      <td><strong>stopPrice</strong></td>
      <td>The stop price associated with the order (<code>null</code>), as this is not a stop order.</td>
    </tr>
    <tr>
      <td><strong>lockedMargin</strong></td>
      <td>The amount of margin locked in INR (<code>0</code> INR).</td>
    </tr>
    <tr>
      <td><strong>lockedMarginInMarginAsset</strong></td>
      <td>The amount of margin locked in the margin asset (<code>0</code> INR).</td>
    </tr>
    <tr>
      <td><strong>marginAsset</strong></td>
      <td>The asset used for margin (INR).</td>
    </tr>
    <tr>
      <td><strong>contractType</strong></td>
      <td>The type of contract (<code>PERPETUAL</code>), indicating a perpetual futures contract.</td>
    </tr>
    <tr>
      <td><strong>iconUrl</strong></td>
      <td>The URL of the contract icon (<a href="https://storage.googleapis.com/pi42-dev-static/contract-icons/btc.png" target="_blank">BTC Icon</a>).</td>
    </tr>
    <tr>
      <td><strong>quoteAsset</strong></td>
      <td>The currency used for the transaction (INR).</td>
    </tr>
    <tr>
      <td><strong>baseAsset</strong></td>
      <td>The asset being traded (Bitcoin).</td>
    </tr>
    <tr>
      <td><strong>leveragedQty</strong></td>
      <td>The quantity of Bitcoin being traded with leverage (<code>0.002</code> BTC).</td>
    </tr>
  </tbody>
</table>

<h2 id="get-linked-orders">Get Linked Orders</h2>

<p><code>GET /v1/order/linked-orders</code></p>

<p>Retrieves orders that are linked by a specific link ID. It is used to fetch all orders associated with a given link ID, which can help in tracking related orders or managing linked order groups.</p>

<div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># Function to fetch linked orders based on linkId
</span><span class="k">def</span> <span class="nf">linked_orders</span><span class="p">():</span>
<span class="n">link_id</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the Link Id: "</span><span class="p">)</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">linked_orders_url</span> <span class="o">=</span> <span class="s">"https://fapi.pi42.com/v1/order/linked-orders"</span>

<span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">linked_orders_url</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">link_id</span><span class="si">}</span><span class="s">"</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
<span class="p">}</span>
<span class="n">query_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"timestamp=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'timestamp'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span>

<span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">query_string</span><span class="p">)</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
<span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
<span class="s">'accept'</span><span class="p">:</span> <span class="s">'*/*'</span>
 <span class="p">}</span>
<span class="k">try</span><span class="p">:</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s">?</span><span class="si">{</span><span class="n">query_string</span><span class="si">}</span><span class="s">"</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
<span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Linked orders fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// Get Linked Orders</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">linkedOrders</span><span class="p">(</span><span class="nx">linkId</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">linkId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">6acd808ba5957340b009-6238-ext</span><span class="dl">"</span>
  <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="s2">`/v1/order/linked-orders/</span><span class="p">${</span><span class="nx">linkId</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span> <span class="c1">// Endpoint for fetching linked orders</span>

<span class="c1">// Call the getRequest function (similar to postRequest)</span>
  <span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Fetch Margin History</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchMarginHistory</span><span class="p">()</span> <span class="p">{</span>
 <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/order/fetch-margin-history</span><span class="dl">"</span><span class="p">;</span>
 <span class="kd">const</span> <span class="nx">pageSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
 <span class="kd">const</span> <span class="nx">sortOrder</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">;</span>
 <span class="kd">const</span> <span class="nx">startTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1696425435000</span><span class="dl">"</span><span class="p">;</span>
 <span class="kd">const</span> <span class="nx">endTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1725451568979</span><span class="dl">"</span><span class="p">;</span>
 <span class="kd">const</span> <span class="nx">symbol</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCUSDT</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Prepare query parameters</span>
 <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>

<span class="c1">// Optional Params</span>
 <span class="na">pageSize</span><span class="p">:</span> <span class="nx">pageSize</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
 <span class="na">sortOrder</span><span class="p">:</span> <span class="nx">sortOrder</span><span class="p">,</span>
 <span class="na">startTimestamp</span><span class="p">:</span> <span class="nx">startTimestamp</span><span class="p">,</span>
 <span class="na">endTimestamp</span><span class="p">:</span> <span class="nx">endTimestamp</span><span class="p">,</span>
 <span class="na">symbol</span><span class="p">:</span> <span class="nx">symbol</span><span class="p">,</span>
 <span class="p">};</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>linkId</td>
            <td>string</td>
            <td>Yes</td>
            <td>The unique identifier for the linked orders</td>
        </tr>
    </tbody>
</table>

<aside class="notice">
Requires linkId that can be obtained from <a href="#place-order">Place Order API response.</a>
</aside>

<h3 id='response-6'>Response</h3>

<p>The details returned in the response body as are as follows:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="w">
</span><span class="err">//</span><span class="w"> </span><span class="err">Response</span><span class="w">
</span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"clientOrderId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"m2l-1f04cd91efa7ebe09cad-6238-ext"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-11T12:14:03.706Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"symbol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTCINR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"contractType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PERPETUAL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MARKET"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"side"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BUY"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mi">5054068</span><span class="p">,</span><span class="w">
    </span><span class="nl">"orderAmount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.002</span><span class="p">,</span><span class="w">
    </span><span class="nl">"filledAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"linkId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"m2l-1f04cd91efa7ebe09cad-6238-ext"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"subType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PRIMARY"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"linkType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ORDER_SL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"takeProfitPrice"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"stopLossPrice"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NEW"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"placeType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ORDER_FORM"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTC"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quoteAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>clientOrderId</strong></td>
      <td>Unique identifier for the client's order (<code>m2l-1f04cd91efa7ebe09cad-6238-ext</code>).</td>
    </tr>
    <tr>
      <td><strong>time</strong></td>
      <td>The timestamp when the order was created (<code>2024-09-11T12:14:03.706Z</code>).</td>
    </tr>
    <tr>
      <td><strong>symbol</strong></td>
      <td>The trading pair involved (<code>BTCINR</code>), indicating Bitcoin (BTC) traded against Indian Rupees (INR).</td>
    </tr>
    <tr>
      <td><strong>contractType</strong></td>
      <td>The type of contract (<code>PERPETUAL</code>), indicating a perpetual futures contract.</td>
    </tr>
    <tr>
      <td><strong>type</strong></td>
      <td>The order type (<code>MARKET</code>), meaning the order was executed at the current market price.</td>
    </tr>
    <tr>
      <td><strong>side</strong></td>
      <td>Indicates whether the order is to buy or sell (<code>BUY</code>).</td>
    </tr>
    <tr>
      <td><strong>price</strong></td>
      <td>The price per unit of Bitcoin at the time the order was placed (<code>5054068 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>orderAmount</strong></td>
      <td>The total amount of Bitcoin to be bought (<code>0.002 BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>filledAmount</strong></td>
      <td>The amount of Bitcoin that has been filled so far (<code>0 BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>linkId</strong></td>
      <td>Unique identifier for the linked order (<code>m2l-1f04cd91efa7ebe09cad-6238-ext</code>).</td>
    </tr>
    <tr>
      <td><strong>subType</strong></td>
      <td>The order classification (<code>PRIMARY</code>), indicating the main order type.</td>
    </tr>
    <tr>
      <td><strong>linkType</strong></td>
      <td>Indicates the link type of the order (<code>ORDER_SL</code>), possibly linking to a stop-loss order.</td>
    </tr>
    <tr>
      <td><strong>takeProfitPrice</strong></td>
      <td>The take-profit price associated with the order (<code>null</code>), indicating no take-profit price set.</td>
    </tr>
    <tr>
      <td><strong>stopLossPrice</strong></td>
      <td>The stop-loss price associated with the order (<code>null</code>), indicating no stop-loss price set.</td>
    </tr>
    <tr>
      <td><strong>status</strong></td>
      <td>The current status of the order (<code>NEW</code>), meaning the order has been placed but not filled.</td>
    </tr>
    <tr>
      <td><strong>placeType</strong></td>
      <td>The method by which the order was placed (<code>ORDER_FORM</code>), likely using an order form interface.</td>
    </tr>
    <tr>
      <td><strong>baseAsset</strong></td>
      <td>The base asset being traded (<code>BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>quoteAsset</strong></td>
      <td>The currency used for the transaction (<code>INR</code>).</td>
    </tr>
  </tbody>
</table>

<h2 id="get-margin-history">Fetch Margin History</h2>

<p><code>GET /v1/order/fetch-margin-history</code></p>

<p>Retrieves the margin history for an account.</p>

<p>It supports optional filtering parameters like page size, sorting order, timestamps, and trading symbol.</p>

<p>This endpoint is useful for analyzing past margin activities and historical changes in margin levels.</p>

<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">fetch_margin_history</span><span class="p">():</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="s">"/v1/order/fetch-margin-history"</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the symbol (e.g., BTCUSDT): "</span><span class="p">).</span><span class="n">upper</span><span class="p">()</span>

    <span class="n">pageSize</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">sortOrder</span> <span class="o">=</span> <span class="s">"desc"</span>

<span class="c1"># Generate current timestamp for signing
</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

<span class="c1"># Prepare query parameters
</span>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'pageSize'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">pageSize</span><span class="p">),</span>
    <span class="s">'sortOrder'</span><span class="p">:</span> <span class="n">sortOrder</span><span class="p">,</span>
    <span class="s">'symbol'</span><span class="p">:</span> <span class="n">symbol</span><span class="p">,</span>
    <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
    <span class="p">}</span>

<span class="c1"># Convert params to query string
</span>    <span class="n">query_string</span> <span class="o">=</span> <span class="s">'&amp;'</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s">"</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="p">.</span><span class="n">items</span><span class="p">()])</span>

<span class="c1"># Generate signature
</span>    <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">query_string</span><span class="p">)</span>

<span class="c1"># Headers for the request
</span>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
     <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
    <span class="s">'accept'</span><span class="p">:</span> <span class="s">'*/*'</span>
    <span class="p">}</span>
<span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}{</span><span class="n">endpoint</span><span class="si">}</span><span class="s">?</span><span class="si">{</span><span class="n">query_string</span><span class="si">}</span><span class="s">"</span>

<span class="k">try</span><span class="p">:</span>
<span class="c1"># Send the GET request to fetch margin history
</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span> <span class="c1"># Raises an error for 4xx/5xx responses
</span><span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Margin history fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="c1">// Fetch Margin History</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchMarginHistory</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/order/fetch-margin-history</span><span class="dl">"</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">pageSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">sortOrder</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">startTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1696425435000</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">endTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1725451568979</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">symbol</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCUSDT</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// Prepare query parameters</span>
  <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>

<span class="c1">// Optional Params</span>
    <span class="na">pageSize</span><span class="p">:</span> <span class="nx">pageSize</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
    <span class="na">sortOrder</span><span class="p">:</span> <span class="nx">sortOrder</span><span class="p">,</span>
    <span class="na">startTimestamp</span><span class="p">:</span> <span class="nx">startTimestamp</span><span class="p">,</span>
    <span class="na">endTimestamp</span><span class="p">:</span> <span class="nx">endTimestamp</span><span class="p">,</span>
    <span class="na">symbol</span><span class="p">:</span> <span class="nx">symbol</span><span class="p">,</span>
  <span class="p">};</span>

<span class="c1">// Call the getRequest function</span>
  <span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>pageSize</td>
            <td>string</td>
            <td>No</td>
            <td>The number of results to return per page</td>
        </tr>
        <tr>
            <td>sortOrder</td>
            <td>string</td>
            <td>No</td>
            <td>The sorting order for the results (e.g., "asc" or "desc")</td>
        </tr>
        <tr>
            <td>startTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The start timestamp (in milliseconds) for filtering margin history</td>
        </tr>
        <tr>
            <td>endTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The end timestamp (in milliseconds) for filtering margin history</td>
        </tr>
        <tr>
            <td>symbol</td>
            <td>string</td>
            <td>No</td>
            <td>The trading pair symbol to filter the margin history (e.g., BTCUSDT)</td>
        </tr>
    </tbody>
</table>

<h3 id='response-7'>Response</h3>

<p>The response details are as follows:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Response</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">549</span><span class="p">,</span><span class="w">
      </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w">
      </span><span class="nl">"refId"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
      </span><span class="nl">"marginInMarginAsset"</span><span class="p">:</span><span class="w"> </span><span class="mf">8.7</span><span class="p">,</span><span class="w">
      </span><span class="nl">"marginAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"positionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"90483119-0c3a-4cc0-9afa-25366f907fca"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"operation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"REDUCE_MARGIN"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-12T08:59:57.707Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"updatedAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-12T08:59:57.707Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"totalCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w">
  </span><span class="nl">"nextTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1725624883814"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>id</strong></td>
      <td>Unique identifier for the margin operation (<code>549</code>).</td>
    </tr>
    <tr>
      <td><strong>amount</strong></td>
      <td>The amount involved in the margin operation (<code>0.1</code>).</td>
    </tr>
    <tr>
      <td><strong>refId</strong></td>
      <td>Reference ID associated with the operation (<code>null</code>, indicating no reference ID).</td>
    </tr>
    <tr>
      <td><strong>marginInMarginAsset</strong></td>
      <td>Margin in the margin asset (<code>8.7</code> INR).</td>
    </tr>
    <tr>
      <td><strong>marginAsset</strong></td>
      <td>The asset used for margin (<code>INR</code>).</td>
    </tr>
    <tr>
      <td><strong>positionId</strong></td>
      <td>Unique identifier for the position associated with the margin operation (<code>90483119-0c3a-4cc0-9afa-25366f907fca</code>).</td>
    </tr>
    <tr>
      <td><strong>operation</strong></td>
      <td>The type of operation performed (<code>REDUCE_MARGIN</code>).</td>
    </tr>
    <tr>
      <td><strong>createdAt</strong></td>
      <td>Timestamp when the margin operation was created (<code>2024-09-12T08:59:57.707Z</code>).</td>
    </tr>
    <tr>
      <td><strong>updatedAt</strong></td>
      <td>Timestamp when the margin operation was last updated (<code>2024-09-12T08:59:57.707Z</code>).</td>
    </tr>
    <tr>
      <td><strong>totalCount</strong></td>
      <td>The total number of margin operations recorded (<code>45</code>).</td>
    </tr>
    <tr>
      <td><strong>nextTimestamp</strong></td>
      <td>The next timestamp for fetching data (<code>1725624883814</code>).</td>
    </tr>
  </tbody>
</table>

<h2 id="get-positions">Get Positions</h2>

<p><code>GET /v1/positions</code></p>

<p>Retrieves positions based on their status.</p>

<p>It allows filtering positions by their status (e.g., &quot;OPEN&quot;) and supports additional optional parameters such as timestamps, sorting order, page size, and trading symbol.</p>

<p>This endpoint is useful for fetching current or historical positions and managing your trading portfolio.</p>

<div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># Function to fetch positions
</span><span class="k">def</span> <span class="nf">fetch_positions</span><span class="p">():</span>
<span class="n">position_status</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter position status (open, closed, liquidated): "</span><span class="p">).</span><span class="n">upper</span><span class="p">()</span>
<span class="n">symbol</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the trading pair (e.g., BTCINR): "</span><span class="p">).</span><span class="n">upper</span><span class="p">()</span>

<span class="k">if</span> <span class="n">position_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"OPEN"</span><span class="p">,</span> <span class="s">"CLOSED"</span><span class="p">,</span> <span class="s">"LIQUIDATED"</span><span class="p">]:</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Invalid position status. Please enter 'open', 'closed', or 'liquidated'."</span><span class="p">)</span>
<span class="k">return</span>

<span class="c1"># Optional parameters
</span><span class="n">sort_order</span> <span class="o">=</span> <span class="s">"desc"</span> <span class="c1"># Default sort order
</span><span class="n">page_size</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Default page size
</span>
<span class="c1"># Prepare the query parameters
</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">'sortOrder'</span><span class="p">:</span> <span class="n">sort_order</span><span class="p">,</span>
<span class="s">'pageSize'</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">page_size</span><span class="p">),</span>
<span class="s">'symbol'</span><span class="p">:</span> <span class="n">symbol</span><span class="p">,</span>
  <span class="p">}</span>

<span class="c1"># Generate current timestamp
</span><span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
<span class="n">params</span><span class="p">[</span><span class="s">'timestamp'</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>

<span class="c1"># Generate signature based on the parameters
</span><span class="n">query_string</span> <span class="o">=</span> <span class="s">'&amp;'</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s">"</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="p">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">query_string</span><span class="p">)</span>

<span class="c1"># Headers for the GET request
</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
<span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
<span class="s">'accept'</span><span class="p">:</span> <span class="s">'*/*'</span>
 <span class="p">}</span>

<span class="c1"># Construct the full URL including the path parameter for position status
</span><span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">/v1/positions/</span><span class="si">{</span><span class="n">position_status</span><span class="si">}</span><span class="s">?</span><span class="si">{</span><span class="n">query_string</span><span class="si">}</span><span class="s">"</span>

<span class="k">try</span><span class="p">:</span>
<span class="c1"># Send the GET request to fetch positions
</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span> <span class="c1"># Raises an error for 4xx/5xx responses
</span><span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Positions fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchPositions</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/positions/</span><span class="dl">"</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">positionStatus</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">OPEN</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Required parameter</span>
  <span class="kd">const</span> <span class="nx">startTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1696425435000</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Optional</span>
  <span class="kd">const</span> <span class="nx">endTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1725451568979</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Optional</span>
  <span class="kd">const</span> <span class="nx">sortOrder</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Optional</span>
  <span class="kd">const</span> <span class="nx">pageSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="c1">// Optional</span>
  <span class="kd">const</span> <span class="nx">symbol</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCINR</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Optional</span>

  <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">// Optional Params</span>
    <span class="c1">// pageSize: pageSize.toString(),</span>
    <span class="c1">// sortOrder: sortOrder,</span>
    <span class="c1">// startTimestamp: startTimestamp,</span>
    <span class="c1">// endTimestamp: endTimestamp,</span>
    <span class="c1">// symbol: symbol,</span>
  <span class="p">};</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}${</span><span class="nx">positionStatus</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="c1">// Call the getRequest function</span>
  <span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>positionStatus</td>
            <td>string</td>
            <td>Yes</td>
            <td>The status of the positions to retrieve (e.g., "OPEN")</td>
        </tr>
        <tr>
            <td>startTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The start timestamp (in milliseconds) for filtering positions</td>
        </tr>
        <tr>
            <td>endTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The end timestamp (in milliseconds) for filtering positions</td>
        </tr>
        <tr>
            <td>sortOrder</td>
            <td>string</td>
            <td>No</td>
            <td>The sorting order for the results (e.g., "asc" or "desc")</td>
        </tr>
        <tr>
            <td>pageSize</td>
            <td>string</td>
            <td>No</td>
            <td>The number of results to return per page</td>
        </tr>
        <tr>
            <td>symbol</td>
            <td>string</td>
            <td>No</td>
            <td>The trading pair symbol to filter positions (e.g., BTCINR)</td>
        </tr>
    </tbody>
</table>

<h3 id='response-8'>Response</h3>

<p>The response parameters are described below:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5454</span><span class="p">,</span><span class="w">
  </span><span class="nl">"contractPair"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GRTINR"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"contractType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PERPETUAL"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"entryPrice"</span><span class="p">:</span><span class="w"> </span><span class="mf">12.541</span><span class="p">,</span><span class="w">
  </span><span class="nl">"leverage"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="nl">"liquidationPrice"</span><span class="p">:</span><span class="w"> </span><span class="mf">11.4</span><span class="p">,</span><span class="w">
  </span><span class="nl">"marginType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISOLATED"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"margin"</span><span class="p">:</span><span class="w"> </span><span class="mf">45.6</span><span class="p">,</span><span class="w">
  </span><span class="nl">"marginInMarginAsset"</span><span class="p">:</span><span class="w"> </span><span class="mf">45.6</span><span class="p">,</span><span class="w">
  </span><span class="nl">"positionAmount"</span><span class="p">:</span><span class="w"> </span><span class="mi">36</span><span class="p">,</span><span class="w">
  </span><span class="nl">"positionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8b56348d-0d5d-4de1-85e1-3325bdf84087"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"positionSize"</span><span class="p">:</span><span class="w"> </span><span class="mf">451.48</span><span class="p">,</span><span class="w">
  </span><span class="nl">"positionStatus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OPEN"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"positionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LONG"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"realizedProfit"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nl">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">36</span><span class="p">,</span><span class="w">
  </span><span class="nl">"baseAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GRT"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"marginAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"quoteAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"createdTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-16T09:39:41.689Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"updatedTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-16T09:39:41.689Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>id</strong></td>
      <td>Unique identifier for the position (<code>5454</code>).</td>
    </tr>
    <tr>
      <td><strong>contractPair</strong></td>
      <td>The trading pair for the contract (<code>GRTINR</code>), indicating GRT traded against INR.</td>
    </tr>
    <tr>
      <td><strong>contractType</strong></td>
      <td>The type of contract (<code>PERPETUAL</code>), indicating a perpetual futures contract.</td>
    </tr>
    <tr>
      <td><strong>entryPrice</strong></td>
      <td>The price at which the position was entered (<code>12.541 INR</code> per GRT).</td>
    </tr>
    <tr>
      <td><strong>leverage</strong></td>
      <td>The leverage applied to the trade (<code>10x</code>).</td>
    </tr>
    <tr>
      <td><strong>liquidationPrice</strong></td>
      <td>The price at which the position would be liquidated (<code>11.4 INR</code> per GRT).</td>
    </tr>
    <tr>
      <td><strong>marginType</strong></td>
      <td>The type of margin used for the position (<code>ISOLATED</code>).</td>
    </tr>
    <tr>
      <td><strong>margin</strong></td>
      <td>The amount of margin allocated to the position (<code>45.6 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>marginInMarginAsset</strong></td>
      <td>The amount of margin in the margin asset (<code>45.6 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>positionAmount</strong></td>
      <td>The amount of the position (<code>36 GRT</code>).</td>
    </tr>
    <tr>
      <td><strong>positionId</strong></td>
      <td>Unique identifier for the position (<code>8b56348d-0d5d-4de1-85e1-3325bdf84087</code>).</td>
    </tr>
    <tr>
      <td><strong>positionSize</strong></td>
      <td>The size of the position in terms of value (<code>451.48 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>positionStatus</strong></td>
      <td>The current status of the position (<code>OPEN</code>).</td>
    </tr>
    <tr>
      <td><strong>positionType</strong></td>
      <td>The type of position (<code>LONG</code>).</td>
    </tr>
    <tr>
      <td><strong>realizedProfit</strong></td>
      <td>The profit realized from the position (<code>null</code>, indicating no realized profit yet).</td>
    </tr>
    <tr>
      <td><strong>quantity</strong></td>
      <td>The quantity of the asset involved (<code>36 GRT</code>).</td>
    </tr>
    <tr>
      <td><strong>baseAsset</strong></td>
      <td>The base asset being traded (<code>GRT</code>).</td>
    </tr>
    <tr>
      <td><strong>marginAsset</strong></td>
      <td>The asset used for margin (<code>INR</code>).</td>
    </tr>
    <tr>
      <td><strong>quoteAsset</strong></td>
      <td>The currency used for the transaction (<code>INR</code>).</td>
    </tr>
    <tr>
      <td><strong>createdTime</strong></td>
      <td>The timestamp when the position was created (<code>2024-09-16T09:39:41.689Z</code>).</td>
    </tr>
    <tr>
      <td><strong>updatedTime</strong></td>
      <td>The timestamp when the position was last updated (<code>2024-09-16T09:39:41.689Z</code>).</td>
    </tr>
  </tbody>
</table>

<h2 id="get-position-status">Get Position Status</h2>

<p><code>GET /v1/positions/{positionStatus}</code></p>

<p>Retrieves details for a specific position identified by its unique position ID.</p>

<p>It returns information related to the specified position, such as current status, asset details, and other relevant data.</p>

<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">get_positions</span><span class="p">():</span>
 <span class="n">position_status</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter position status (open, closed, liquidated): "</span><span class="p">).</span><span class="n">upper</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">position_status</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">"OPEN"</span><span class="p">,</span> <span class="s">"CLOSED"</span><span class="p">,</span> <span class="s">"LIQUIDATED"</span><span class="p">]:</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"Invalid position status. Please enter 'open', 'closed', or 'liquidated'."</span><span class="p">)</span>
  <span class="k">return</span>

<span class="c1"># Generate the current timestamp
</span>    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

<span class="c1"># Prepare the query parameters
</span>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'sortOrder'</span><span class="p">:</span> <span class="s">'desc'</span><span class="p">,</span>
    <span class="s">'pageSize'</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
    <span class="p">}</span>

<span class="c1"># Convert the params into a query string to sign
</span>    <span class="n">query_string</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"sortOrder=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'sortOrder'</span><span class="p">]</span><span class="si">}</span><span class="s">&amp;pageSize=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'pageSize'</span><span class="p">]</span><span class="si">}</span><span class="s">&amp;timestamp=
    </span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'timestamp'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span>

<span class="c1"># Generate the signature
</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">query_string</span><span class="p">)</span>

<span class="c1"># Headers for the GET request
</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
<span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
<span class="s">'accept'</span><span class="p">:</span> <span class="s">'*/*'</span>
 <span class="p">}</span>

<span class="c1"># Construct the full URL including the path parameter for position status
</span><span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">/v1/positions/</span><span class="si">{</span><span class="n">position_status</span><span class="si">}</span><span class="s">?sortOrder=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'sortOrder'</span><span class="p">]</span><span class="si">}</span><span class="s">&amp;pageSize=
</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'pageSize'</span><span class="p">]</span><span class="si">}</span><span class="s">&amp;timestamp=</span><span class="si">{</span><span class="n">params</span><span class="p">[</span><span class="s">'timestamp'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span>

<span class="k">try</span><span class="p">:</span>
<span class="c1"># Send the GET request to fetch positions
</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span> <span class="c1"># Raises an error for 4xx/5xx responses
</span><span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Positions fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
<span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">getPosition</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/positions</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">positionId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">sample-2c52-45cb-addf-9c1fde92fce5</span><span class="dl">"</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">positionId</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>positionId</td>
            <td>string</td>
            <td>Yes</td>
            <td>The unique identifier for the position to retrieve</td>
        </tr>
    </tbody>
</table>

<h3 id='response-9'>Response</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Response</span><span class="w">
</span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"contractPair"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTCUSDT"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"entryPrice"</span><span class="p">:</span><span class="w"> </span><span class="mf">58003.7</span><span class="p">,</span><span class="w">
        </span><span class="nl">"leverage"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
        </span><span class="nl">"liquidationPrice"</span><span class="p">:</span><span class="w"> </span><span class="mf">52173.1</span><span class="p">,</span><span class="w">
        </span><span class="nl">"marginType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISOLATED"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"marginAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"margin"</span><span class="p">:</span><span class="w"> </span><span class="mf">19.404</span><span class="p">,</span><span class="w">
        </span><span class="nl">"marginInMarginAsset"</span><span class="p">:</span><span class="w"> </span><span class="mf">1688.15</span><span class="p">,</span><span class="w">
        </span><span class="nl">"positionAmount"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.003</span><span class="p">,</span><span class="w">
        </span><span class="nl">"positionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dd89732b-3a9d-4500-acec-64e1384c7149"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"positionSize"</span><span class="p">:</span><span class="w"> </span><span class="mf">174.0111</span><span class="p">,</span><span class="w">
        </span><span class="nl">"positionStatus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OPEN"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"positionType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LONG"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"realizedProfit"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
        </span><span class="nl">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.003</span><span class="p">,</span><span class="w">
        </span><span class="nl">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-13T08:19:18.642Z"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"contractType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PERPETUAL"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"iconUrl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://storage.googleapis.com/pi42-dev-static/contract-icons/btc.png"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"baseAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTC"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"quoteAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"USDT"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>contractPair</strong></td>
      <td>The trading pair for the contract (<code>BTCUSDT</code>), indicating Bitcoin (BTC) traded against USDT (Tether).</td>
    </tr>
    <tr>
      <td><strong>entryPrice</strong></td>
      <td>The price at which the position was entered (<code>58003.7 USDT</code>).</td>
    </tr>
    <tr>
      <td><strong>leverage</strong></td>
      <td>The leverage applied to the trade (<code>9x</code>).</td>
    </tr>
    <tr>
      <td><strong>liquidationPrice</strong></td>
      <td>The price at which the position would be liquidated (<code>52173.1 USDT</code>).</td>
    </tr>
    <tr>
      <td><strong>marginType</strong></td>
      <td>The type of margin used for the position (<code>ISOLATED</code>).</td>
    </tr>
    <tr>
      <td><strong>marginAsset</strong></td>
      <td>The asset used for margin (<code>INR</code>).</td>
    </tr>
    <tr>
      <td><strong>margin</strong></td>
      <td>The amount of margin allocated to the position (<code>19.404 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>marginInMarginAsset</strong></td>
      <td>The amount of margin in the margin asset (<code>1688.15 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>positionAmount</strong></td>
      <td>The amount of the position (<code>0.003 BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>positionId</strong></td>
      <td>Unique identifier for the position (<code>dd89732b-3a9d-4500-acec-64e1384c7149</code>).</td>
    </tr>
    <tr>
      <td><strong>positionSize</strong></td>
      <td>The size of the position in terms of value (<code>174.0111 USDT</code>).</td>
    </tr>
    <tr>
      <td><strong>positionStatus</strong></td>
      <td>The current status of the position (<code>OPEN</code>).</td>
    </tr>
    <tr>
      <td><strong>positionType</strong></td>
      <td>The type of position (<code>LONG</code>).</td>
    </tr>
    <tr>
      <td><strong>realizedProfit</strong></td>
      <td>The profit realized from the position (<code>0</code>, indicating no realized profit yet).</td>
    </tr>
    <tr>
      <td><strong>quantity</strong></td>
      <td>The quantity of the asset involved (<code>0.003 BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>createdAt</strong></td>
      <td>The timestamp when the position was created (<code>2024-09-13T08:19:18.642Z</code>).</td>
    </tr>
    <tr>
      <td><strong>contractType</strong></td>
      <td>The type of contract (<code>PERPETUAL</code>), indicating a perpetual futures contract.</td>
    </tr>
    <tr>
      <td><strong>iconUrl</strong></td>
      <td>The URL for the contract icon (<code>https://storage.googleapis.com/pi42-dev-static/contract-icons/btc.png</code>).</td>
    </tr>
    <tr>
      <td><strong>baseAsset</strong></td>
      <td>The base asset being traded (<code>BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>quoteAsset</strong></td>
      <td>The currency used for the transaction (<code>USDT</code>).</td>
    </tr>
  </tbody>
</table>

<h2 id="trade-history">Get User's Trade History</h2>

<p><code>GET /v1/user-data/trade-history</code></p>

<p>Retrieves the trade history for a user.</p>

<p>It supports optional filtering parameters such as timestamps, sorting order, page size, and trading symbol to help users access their historical trade data efficiently.</p>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchUserTradeHistory</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/user-data/trade-history</span><span class="dl">"</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">startTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1696425435000</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Optional</span>
  <span class="kd">const</span> <span class="nx">endTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1725451568979</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Optional</span>
  <span class="kd">const</span> <span class="nx">sortOrder</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Optional</span>
  <span class="kd">const</span> <span class="nx">pageSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span> <span class="c1">// Optional</span>
  <span class="kd">const</span> <span class="nx">symbol</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCINR</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Optional</span>

<span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
   <span class="c1">//Optional Params</span>
    <span class="na">pageSize</span><span class="p">:</span> <span class="nx">pageSize</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
    <span class="na">sortOrder</span><span class="p">:</span> <span class="nx">sortOrder</span><span class="p">,</span>
    <span class="na">startTimestamp</span><span class="p">:</span> <span class="nx">startTimestamp</span><span class="p">,</span>
    <span class="na">endTimestamp</span><span class="p">:</span> <span class="nx">endTimestamp</span><span class="p">,</span>
    <span class="na">symbol</span><span class="p">:</span> <span class="nx">symbol</span><span class="p">,</span>
  <span class="p">};</span>

<span class="c1">// Call the getRequest function</span>
  <span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="c1"># Function to fetch trade history
</span><span class="k">def</span> <span class="nf">trade_history</span><span class="p">():</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>
    <span class="n">trade_history_url</span> <span class="o">=</span> <span class="s">"https://fapi.pi42.com/v1/user-data/trade-history"</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">sortOrder</span><span class="s">': '</span><span class="n">desc</span><span class="s">',
    '</span><span class="n">pageSize</span><span class="s">': 100,
    '</span><span class="n">timestamp</span><span class="s">': timestamp
 }

query_string = f"sortOrder={params['</span><span class="n">sortOrder</span><span class="s">']}&amp;pageSize={params['</span><span class="n">pageSize</span><span class="s">']}&amp;timestamp=
{params['</span><span class="n">timestamp</span><span class="s">']}"

 signature = generate_signature(api_secret, query_string)

 headers = {
    '</span><span class="n">api</span><span class="o">-</span><span class="n">key</span><span class="s">': api_key,
    '</span><span class="n">signature</span><span class="s">': signature,
    '</span><span class="n">accept</span><span class="s">': '</span><span class="o">*/*</span><span class="s">'
 }

try:
    response = requests.get(f"{trade_history_url}?{query_string}", headers=headers)
    response.raise_for_status()
    response_data = response.json()
    print('</span><span class="n">Trade</span> <span class="n">history</span> <span class="n">fetched</span> <span class="n">successfully</span><span class="p">:</span><span class="s">', json.dumps(response_data, indent=4))
except requests.exceptions.HTTPError as err:
    print(f"Failed {response.status_code}: {response.text}")
</span></code></pre></div>
<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>startTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The start timestamp (in milliseconds) for filtering trade history</td>
        </tr>
        <tr>
            <td>endTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The end timestamp (in milliseconds) for filtering trade history</td>
        </tr>
        <tr>
            <td>sortOrder</td>
            <td>string</td>
            <td>No</td>
            <td>The sorting order for the results (e.g., "asc" or "desc")</td>
        </tr>
        <tr>
            <td>pageSize</td>
            <td>string</td>
            <td>No</td>
            <td>The number of results to return per page</td>
        </tr>
        <tr>
            <td>symbol</td>
            <td>string</td>
            <td>No</td>
            <td>The trading pair symbol to filter trade history (e.g., BTCINR)</td>
        </tr>
    </tbody>
</table>
<h3 id='response-10'>Response</h3>

<p>The response parameters are as follows:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">26260</span><span class="p">,</span><span class="w">
    </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-16T09:39:41.675Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"symbol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GRTINR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"LIMIT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"side"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BUY"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"price"</span><span class="p">:</span><span class="w"> </span><span class="mf">12.541</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quantity"</span><span class="p">:</span><span class="w"> </span><span class="mi">36</span><span class="p">,</span><span class="w">
    </span><span class="nl">"role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MAKER"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fee"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"realizedProfit"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"contractType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PERPETUAL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"clientOrderId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8acc0af94a3516126cdf-6238-ext"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GRT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quoteAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"marginAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>id</strong></td>
      <td>Unique identifier for the order (<code>26260</code>).</td>
    </tr>
    <tr>
      <td><strong>time</strong></td>
      <td>Timestamp when the order was placed (<code>2024-09-16T09:39:41.675Z</code>).</td>
    </tr>
    <tr>
      <td><strong>symbol</strong></td>
      <td>The trading pair for the order (<code>GRTINR</code>), indicating GRT (The Graph) traded against INR (Indian Rupee).</td>
    </tr>
    <tr>
      <td><strong>type</strong></td>
      <td>The type of order (<code>LIMIT</code>), indicating a limit order.</td>
    </tr>
    <tr>
      <td><strong>side</strong></td>
      <td>The side of the order (<code>BUY</code>).</td>
    </tr>
    <tr>
      <td><strong>price</strong></td>
      <td>The price at which the order is to be executed (<code>12.541 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>quantity</strong></td>
      <td>The quantity of the order (<code>36 GRT</code>).</td>
    </tr>
    <tr>
      <td><strong>role</strong></td>
      <td>The role of the order in the trade (<code>MAKER</code>), indicating the order added liquidity to the market.</td>
    </tr>
    <tr>
      <td><strong>fee</strong></td>
      <td>The fee charged for the order (<code>0</code>, indicating no fee).</td>
    </tr>
    <tr>
      <td><strong>realizedProfit</strong></td>
      <td>The profit realized from the order (<code>0</code>, indicating no realized profit yet).</td>
    </tr>
    <tr>
      <td><strong>contractType</strong></td>
      <td>The type of contract for the order (<code>PERPETUAL</code>), indicating a perpetual futures contract.</td>
    </tr>
    <tr>
      <td><strong>clientOrderId</strong></td>
      <td>Unique identifier for the client order (<code>8acc0af94a3516126cdf-6238-ext</code>).</td>
    </tr>
    <tr>
      <td><strong>baseAsset</strong></td>
      <td>The base asset being traded (<code>GRT</code>).</td>
    </tr>
    <tr>
      <td><strong>quoteAsset</strong></td>
      <td>The currency used for the transaction (<code>INR</code>).</td>
    </tr>
    <tr>
      <td><strong>marginAsset</strong></td>
      <td>The asset used for margin (<code>INR</code>).</td>
    </tr>
  </tbody>
</table>

<h2 id="get-transaction-history">Get User's Transaction History</h2>

<p><code>GET/v1/user-data/transaction-history</code></p>

<p>Retrieves the transaction history for a user, allowing filtering and sorting based on optional parameters.</p>

<p>It provides detailed records of transactions within the specified time range and can be filtered by trading symbol, trade ID, and position ID.</p>

<div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">get_transaction_history</span><span class="p">():</span>
    <span class="c1"># Default values for optional parameters
</span>    <span class="n">start_timestamp</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">end_timestamp</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">sort_order</span> <span class="o">=</span> <span class="s">'desc'</span>
    <span class="n">page_size</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">trade_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">position_id</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c1"># Generate the current timestamp (used as part of the authentication/signing process)
</span>    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="c1"># Prepare query parameters with required and optional fields
</span>    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'sortOrder'</span><span class="p">:</span> <span class="n">sort_order</span><span class="p">,</span>
        <span class="s">'pageSize'</span><span class="p">:</span> <span class="n">page_size</span><span class="p">,</span>
        <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
    <span class="p">}</span>

    <span class="c1"># Include optional parameters only if they are provided
</span>    <span class="k">if</span> <span class="n">start_timestamp</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s">'startTimestamp'</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_timestamp</span>
    <span class="k">if</span> <span class="n">end_timestamp</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s">'endTimestamp'</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_timestamp</span>
    <span class="k">if</span> <span class="n">symbol</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s">'symbol'</span><span class="p">]</span> <span class="o">=</span> <span class="n">symbol</span>
    <span class="k">if</span> <span class="n">trade_id</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s">'tradeId'</span><span class="p">]</span> <span class="o">=</span> <span class="n">trade_id</span>
    <span class="k">if</span> <span class="n">position_id</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s">'positionId'</span><span class="p">]</span> <span class="o">=</span> <span class="n">position_id</span>

    <span class="c1"># Convert the parameters to a query string to be signed
</span>    <span class="n">query_string</span> <span class="o">=</span> <span class="s">'&amp;'</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s">"</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="p">.</span><span class="n">items</span><span class="p">()])</span>

    <span class="c1"># Generate the signature (assuming `generate_signature` is defined)
</span>    <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">query_string</span><span class="p">)</span>

    <span class="c1"># Headers for the GET request
</span>    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
        <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
        <span class="s">'accept'</span><span class="p">:</span> <span class="s">'*/*'</span>
    <span class="p">}</span>

    <span class="c1"># Construct the full URL with the query string
</span>    <span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">/v1/user-data/transaction-history?</span><span class="si">{</span><span class="n">query_string</span><span class="si">}</span><span class="s">"</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Send the GET request to fetch transaction history
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raises an error for HTTP 4xx/5xx responses
</span>        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Transaction history fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="c1"># Handle specific HTTP errors
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"HTTP Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="s">'No response text'</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Handle any other exceptions
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchUserTransactionHistory</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/user-data/transaction-history</span><span class="dl">"</span><span class="p">;</span>

    <span class="c1">// Optional parameters for filtering and sorting the transaction history</span>
    <span class="kd">const</span> <span class="nx">startTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1696425435000</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Start timestamp in milliseconds</span>
    <span class="kd">const</span> <span class="nx">endTimestamp</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">1725451568979</span><span class="dl">"</span><span class="p">;</span>   <span class="c1">// End timestamp in milliseconds</span>
    <span class="kd">const</span> <span class="nx">sortOrder</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">desc</span><span class="dl">"</span><span class="p">;</span>               <span class="c1">// Sorting order: "asc" or "desc"</span>
    <span class="kd">const</span> <span class="nx">pageSize</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>                   <span class="c1">// Number of records per page</span>
    <span class="kd">const</span> <span class="nx">symbol</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCINR</span><span class="dl">"</span><span class="p">;</span>                <span class="c1">// Trading symbol, e.g., "BTCINR"</span>
    <span class="kd">const</span> <span class="nx">tradeId</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>                     <span class="c1">// Specific trade ID to filter</span>
    <span class="kd">const</span> <span class="nx">positionId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">3d5f302b-2c52-45cb-addf-9c1fde92fce5</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Specific position ID</span>

    <span class="c1">// Construct the query parameters object</span>
    <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">pageSize</span><span class="p">:</span> <span class="nx">pageSize</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
        <span class="na">sortOrder</span><span class="p">:</span> <span class="nx">sortOrder</span><span class="p">,</span>
        <span class="na">startTimestamp</span><span class="p">:</span> <span class="nx">startTimestamp</span><span class="p">,</span>
        <span class="na">endTimestamp</span><span class="p">:</span> <span class="nx">endTimestamp</span><span class="p">,</span>
        <span class="na">symbol</span><span class="p">:</span> <span class="nx">symbol</span><span class="p">,</span>
        <span class="na">tradeId</span><span class="p">:</span> <span class="nx">tradeId</span><span class="p">,</span>
        <span class="na">positionId</span><span class="p">:</span> <span class="nx">positionId</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="c1">// Call the getRequest function with the endpoint and query parameters</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>startTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The start timestamp (in milliseconds) for filtering transaction history</td>
        </tr>
        <tr>
            <td>endTimestamp</td>
            <td>string</td>
            <td>No</td>
            <td>The end timestamp (in milliseconds) for filtering transaction history</td>
        </tr>
        <tr>
            <td>sortOrder</td>
            <td>string</td>
            <td>No</td>
            <td>The sorting order for the results (e.g., "asc" or "desc")</td>
        </tr>
        <tr>
            <td>pageSize</td>
            <td>string</td>
            <td>No</td>
            <td>The number of records to return per page</td>
        </tr>
        <tr>
            <td>symbol</td>
            <td>string</td>
            <td>No</td>
            <td>The trading symbol to filter the transaction history (e.g., BTCINR)</td>
        </tr>
        <tr>
            <td>tradeId</td>
            <td>number</td>
            <td>No</td>
            <td>The specific trade ID to filter the transaction history</td>
        </tr>
        <tr>
            <td>positionId</td>
            <td>string</td>
            <td>No</td>
            <td>The specific position ID to filter the transaction history</td>
        </tr>
    </tbody>
</table>

<h3 id='response-11'>Response</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">109884</span><span class="p">,</span><span class="w">
    </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-09-16T09:39:28.754Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMMISSION"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mf">-2.1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"asset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"symbol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTCINR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"contractType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PERPETUAL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"baseAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTC"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"quoteAsset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"INR"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>id</strong></td>
      <td>Unique identifier for the transaction (<code>109884</code>).</td>
    </tr>
    <tr>
      <td><strong>time</strong></td>
      <td>Timestamp when the transaction occurred (<code>2024-09-16T09:39:28.754Z</code>).</td>
    </tr>
    <tr>
      <td><strong>type</strong></td>
      <td>The type of the transaction (<code>COMMISSION</code>), indicating a commission fee.</td>
    </tr>
    <tr>
      <td><strong>amount</strong></td>
      <td>The amount of the commission fee (<code>-2.1 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>asset</strong></td>
      <td>The asset for the commission fee (<code>INR</code>).</td>
    </tr>
    <tr>
      <td><strong>symbol</strong></td>
      <td>The trading pair associated with the transaction (<code>BTCINR</code>), indicating Bitcoin (BTC) traded against Indian Rupee (INR).</td>
    </tr>
    <tr>
      <td><strong>contractType</strong></td>
      <td>The type of contract for the transaction (<code>PERPETUAL</code>), indicating a perpetual futures contract.</td>
    </tr>
    <tr>
      <td><strong>baseAsset</strong></td>
      <td>The base asset in the trading pair (<code>BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>quoteAsset</strong></td>
      <td>The currency used for the transaction (<code>INR</code>).</td>
    </tr>
  </tbody>
</table>

<h2 id='exchange-update-leverage'>Update Leverage</h2>

<p><code>POST /v1/exchange/update/leverage</code></p>

<p>Updates the leverage for a specified contract. It allows setting the leverage level for trading a particular asset or trading pair.</p>

<p>This endpoint is used to adjust the leverage settings for risk management and trading strategies.</p>

<aside class="notice">Notes:
<ol>
<li><strong>Update Leverage for Specific Symbols</strong></li>
<ul>
<li>Users can adjust the leverage for individual symbols using the <code>/update/leverage </code> endpoint.</li>
<li>This adjustment applies only to the specified symbol.</li>
</ul>
<li><strong>Placing Orders</strong></li>
<ul>
<li>Orders will be executed with the leverage that was previously set for the symbol.</li>
<li>To use a different leverage for an order, users must first update the leverage for the symbol via the <code>/update/leverage</code> endpoint.</li>
</ul>
</ol>
</aside>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">updateLeverage</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/exchange/update/leverage</span><span class="dl">"</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">leverage</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">contractName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCINR</span><span class="dl">"</span><span class="p">;</span>

    <span class="c1">// Prepare request payload</span>
    <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">leverage</span><span class="p">:</span> <span class="nx">leverage</span><span class="p">,</span>       <span class="c1">// Ensure leverage is an integer</span>
        <span class="na">contractName</span><span class="p">:</span> <span class="nx">contractName</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="c1">// Call the postRequest function</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">postRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">update_leverage</span><span class="p">():</span>
  <span class="n">leverage</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">"Enter the leverage value: "</span><span class="p">))</span>
  <span class="n">contract_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the contract name: "</span><span class="p">)</span>

  <span class="c1"># Generate the current timestamp
</span>  <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

  <span class="c1"># Prepare the request body (JSON)
</span>  <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">'leverage'</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">leverage</span><span class="p">),</span>
      <span class="s">'contractName'</span><span class="p">:</span> <span class="n">contract_name</span><span class="p">,</span>
      <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
  <span class="p">}</span>

  <span class="c1"># Convert the request body to a JSON string for signing
</span>  <span class="n">data_to_sign</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">':'</span><span class="p">))</span>

  <span class="c1"># Generate the signature
</span>  <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">data_to_sign</span><span class="p">)</span>

  <span class="c1"># Headers for the POST request
</span>  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
      <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
      <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span>
  <span class="p">}</span>

  <span class="c1"># Construct the full URL
</span>  <span class="n">update_leverage_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">/v1/exchange/update/leverage"</span>

  <span class="k">try</span><span class="p">:</span>
      <span class="c1"># Send the POST request to update the leverage
</span>      <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">update_leverage_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
      <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span> <span class="c1"># Raises an error for 4xx/5xx responses
</span>      <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
      <span class="k">print</span><span class="p">(</span><span class="s">'Leverage updated successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
  <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div>
<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>leverage</td>
            <td>number</td>
            <td>Yes</td>
            <td>The leverage level to set for the contract (e.g., 10). Must be an integer.</td>
        </tr>
        <tr>
            <td>contractName</td>
            <td>string</td>
            <td>Yes</td>
            <td>The trading pair or contract name to which the leverage applies (e.g., BTCINR)</td>
        </tr>
    </tbody>
</table>
<h3 id='response-12'>Response</h3>

<p>The response parameters are described below:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Response</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"updatedLeverage"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w">
  </span><span class="nl">"contractName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ETHINR"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>updatedLeverage</strong></td>
      <td>The updated leverage for the contract (<code>10</code>).</td>
    </tr>
    <tr>
      <td><strong>contractName</strong></td>
      <td>The name of the contract (<code>ETHINR</code>), indicating Ethereum (ETH) traded against Indian Rupee (INR).</td>
    </tr>
  </tbody>
</table>

<h2 id="delete-order"> Deleting an Order</h2>

<p><code>DELETE /v1/order/delete-order</code></p>

<p>deletes a specific order based on its client order ID.</p>

<p>It requires the client order ID (<code>clientOrderID</code>) to identify the order to be deleted and a timestamp for request validation.</p>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">deleteOrder</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/order/delete-order</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">clientOrderId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">a9c5ba9893c99828e4b5-6238-ext</span><span class="dl">"</span><span class="p">;</span>
    <span class="kd">const</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">().</span><span class="nx">toString</span><span class="p">();</span>

    <span class="c1">// Prepare request payload</span>
    <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">clientOrderId</span><span class="p">:</span> <span class="nx">clientOrderId</span><span class="p">,</span>
        <span class="na">timestamp</span><span class="p">:</span> <span class="nx">timestamp</span><span class="p">,</span>
    <span class="p">};</span>

    <span class="c1">// Call the deleteRequest function</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">deleteRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">delete_order</span><span class="p">():</span>
    <span class="n">client_order_id</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the clientOrderId to delete: "</span><span class="p">)</span>
    <span class="n">delete_order_url</span> <span class="o">=</span> <span class="s">"https://fapi.pi42.com/v1/order/delete-order"</span>

    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'clientOrderId'</span><span class="p">:</span> <span class="n">client_order_id</span><span class="p">,</span>
        <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
    <span class="p">}</span>

    <span class="n">data_to_sign</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">':'</span><span class="p">))</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">data_to_sign</span><span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
        <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
        <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">delete_order_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Order with clientOrderId </span><span class="si">{</span><span class="n">client_order_id</span><span class="si">}</span><span class="s"> deleted successfully."</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>clientOrderId</td>
            <td>string</td>
            <td>Yes</td>
            <td>The unique identifier for the order to be deleted (e.g., a9c5ba9893c99828e4b5-6238-ext)</td>
        </tr>
        <tr>
            <td>timestamp</td>
            <td>string</td>
            <td>Yes</td>
            <td>The current timestamp (in milliseconds) for request validation</td>
        </tr>
    </tbody>
</table>

<aside class="notice">
Requires <code>clientOrderId</code> that can be retrieved from <a href="#get-open-orders">Get Open Orders API</a>.
</aside>

<h3 id='response-13'>Response</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"clientOrderId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"93513fe2a8af44157234-6238-ext"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"orderId"</span><span class="p">:</span><span class="w"> </span><span class="mi">24717</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CANCELED"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>clientOrderId</strong></td>
      <td>Unique identifier for the client order (<code>93513fe2a8af44157234-6238-ext</code>).</td>
    </tr>
    <tr>
      <td><strong>orderId</strong></td>
      <td>Unique identifier for the order (<code>24717</code>).</td>
    </tr>
    <tr>
      <td><strong>status</strong></td>
      <td>The status of the order (<code>CANCELED</code>).</td>
    </tr>
    <tr>
      <td><strong>success</strong></td>
      <td>Indicates whether the operation was successful (<code>true</code>).</td>
    </tr>
  </tbody>
</table>


<h1 id='public-endpoints'>Public Endpoints</h1>

<p>Public endpoints in Pi42 are designed to facilitate easy access to various functionalities of the Pi42 platform, particularly for integration with external systems and applications. 

Below is an overview of the public endpoints available in Pi42, their typical uses, and example API calls.</p>

<h2 id='ticker-update-24hr'>Ticker Update (24Hr)</h2>

<p><code>GET /v1/market/ticker24Hr</code></p>

<p>Fetches the 24-hour market ticker data for a specific trading pair. </p>

<p>It provides details such as the last traded price, volume, and other market metrics over the past 24 hours.</p>
<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchTicker</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/market/ticker24Hr/</span><span class="dl">"</span><span class="p">;</span>  <span class="c1">// API endpoint for fetching the 24-hour market ticker</span>
    <span class="kd">const</span> <span class="nx">contractPair</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCINR</span><span class="dl">"</span><span class="p">;</span>              <span class="c1">// The trading pair for which the ticker data is being requested</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}${</span><span class="nx">contractPair</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>   <span class="c1">// Constructs the full URL by appending the trading pair to the endpoint</span>

    <span class="c1">// Call the getRequest function with the constructed URL</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{});</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">get_24hr_ticker_update</span><span class="p">():</span>
    <span class="c1"># Get the contract pair input from the user
</span>    <span class="n">contract_pair</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the contract pair (e.g., btc, eth): "</span><span class="p">).</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Validate the input
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">contract_pair</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Invalid contract pair. Please enter a valid contract pair (e.g., btc, eth)."</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Construct the full URL for the API request using the provided contract pair
</span>    <span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"https://api.pi42.com/v1/market/ticker24Hr/</span><span class="si">{</span><span class="n">contract_pair</span><span class="si">}</span><span class="s">"</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Send the GET request to the API
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_url</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raise an error for HTTP 4xx/5xx responses
</span>
        <span class="c1"># Parse the JSON response data
</span>        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># Print the 24-hour ticker update in a formatted manner
</span>        <span class="k">print</span><span class="p">(</span><span class="s">'24-hour ticker update fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="c1"># Handle HTTP errors specifically
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Handle any other unexpected errors
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div>
<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>contractPair</td>
            <td>string</td>
            <td>Yes</td>
            <td>The trading pair for which to fetch the ticker data (e.g., BTCINR)</td>
        </tr>
    </tbody>
</table>
<h3 id='response'>Response</h3>

<p>The response parameters are as follows:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Response</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"e"</span><span class="p">:</span><span class="w"> </span><span class="s2">"24hrTicker"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"E"</span><span class="p">:</span><span class="w"> </span><span class="mi">1726313209122</span><span class="p">,</span><span class="w">
    </span><span class="nl">"s"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTCINR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"p"</span><span class="p">:</span><span class="w"> </span><span class="s2">"139470.66"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"P"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2.718"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"w"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5230573.12"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"c"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5271387.66"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Q"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.081"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"o"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5131917"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"h"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5344655.41"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"l"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5079790.8"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"v"</span><span class="p">:</span><span class="w"> </span><span class="s2">"274282.584"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"q"</span><span class="p">:</span><span class="w"> </span><span class="s2">"16265932028.08"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"O"</span><span class="p">:</span><span class="w"> </span><span class="mi">1726226760000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"C"</span><span class="p">:</span><span class="w"> </span><span class="mi">1726313209120</span><span class="p">,</span><span class="w">
    </span><span class="nl">"F"</span><span class="p">:</span><span class="w"> </span><span class="mi">5380307688</span><span class="p">,</span><span class="w">
    </span><span class="nl">"L"</span><span class="p">:</span><span class="w"> </span><span class="mi">5383597456</span><span class="p">,</span><span class="w">
    </span><span class="nl">"n"</span><span class="p">:</span><span class="w"> </span><span class="mi">3289757</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>e</strong></td>
      <td>The event type (<code>24hrTicker</code>), indicating a 24-hour ticker event.</td>
    </tr>
    <tr>
      <td><strong>E</strong></td>
      <td>The event time in milliseconds since epoch (<code>1726313209122</code>).</td>
    </tr>
    <tr>
      <td><strong>s</strong></td>
      <td>The trading pair symbol (<code>BTCINR</code>), indicating Bitcoin (BTC) traded against Indian Rupee (INR).</td>
    </tr>
    <tr>
      <td><strong>p</strong></td>
      <td>The price change in the last 24 hours (<code>139470.66 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>P</strong></td>
      <td>The percentage price change in the last 24 hours (<code>2.718%</code>).</td>
    </tr>
    <tr>
      <td><strong>w</strong></td>
      <td>The weighted average price in the last 24 hours (<code>5230573.12 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>c</strong></td>
      <td>The last price (<code>5271387.66 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>Q</strong></td>
      <td>The last quantity traded (<code>0.081 BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>o</strong></td>
      <td>The open price of the 24-hour period (<code>5131917 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>h</strong></td>
      <td>The highest price in the last 24 hours (<code>5344655.41 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>l</strong></td>
      <td>The lowest price in the last 24 hours (<code>5079790.8 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>v</strong></td>
      <td>The total traded volume in the last 24 hours (<code>274282.584 BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>q</strong></td>
      <td>The total traded quote asset volume in the last 24 hours (<code>16265932028.08 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>O</strong></td>
      <td>The start time of the 24-hour period in milliseconds since epoch (<code>1726226760000</code>).</td>
    </tr>
    <tr>
      <td><strong>C</strong></td>
      <td>The end time of the 24-hour period in milliseconds since epoch (<code>1726313209120</code>).</td>
    </tr>
    <tr>
      <td><strong>F</strong></td>
      <td>The first trade ID in the 24-hour period (<code>5380307688</code>).</td>
    </tr>
    <tr>
      <td><strong>L</strong></td>
      <td>The last trade ID in the 24-hour period (<code>5383597456</code>).</td>
    </tr>
    <tr>
      <td><strong>n</strong></td>
      <td>The number of trades in the 24-hour period (<code>3289757</code>).</td>
    </tr>
  </tbody>
</table>

<h2 id='agg-trade-update'>Aggregate Trade Update</h2>

<p><code>GET /v1/market/aggTrade</code></p>

<p>Retrieves aggregated trade data for a specific trading pair. </p>

<p>Aggregated trades provide summarized information about trade activities, such as total volume and price changes, for the given trading pair.</p>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchAggTrade</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/market/aggTrade/</span><span class="dl">"</span><span class="p">;</span>   <span class="c1">// Define the API endpoint for aggregated trades</span>
    <span class="kd">const</span> <span class="nx">contractPair</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCINR</span><span class="dl">"</span><span class="p">;</span>             <span class="c1">// Specify the trading pair (e.g., Bitcoin to Indian Rupee)</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}${</span><span class="nx">contractPair</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>  <span class="c1">// Construct the full URL by appending the trading pair to the endpoint</span>

    <span class="c1">// Call the getRequest function to send the GET request to the API</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{});</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">get_trade_updates</span><span class="p">():</span>
    <span class="c1"># Prompt the user to enter a contract pair
</span>    <span class="n">contract_pair</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the contract pair (e.g., btc, eth): "</span><span class="p">).</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Validate the user input
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">contract_pair</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Invalid contract pair. Please enter a valid contract pair (e.g., btc, eth)."</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Construct the URL for the API request using the provided contract pair
</span>    <span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"https://api.pi42.com/v1/market/aggTrade/</span><span class="si">{</span><span class="n">contract_pair</span><span class="si">}</span><span class="s">"</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Send the GET request to fetch trade updates
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_url</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raise an exception for HTTP error responses
</span>
        <span class="c1"># Parse the JSON response data
</span>        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># Print the trade updates in a formatted manner
</span>        <span class="k">print</span><span class="p">(</span><span class="s">'Trade updates fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="c1"># Handle HTTP errors specifically
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Handle any other unexpected errors
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>contractPair</td>
            <td>string</td>
            <td>Yes</td>
            <td>The trading pair for which to fetch aggregated trade data (e.g., BTCINR)</td>
        </tr>
    </tbody>
</table>

<h3 id='response-2'>Response</h3>

<p>The response body parameters are described as follows:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Response</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"e"</span><span class="p">:</span><span class="w"> </span><span class="s2">"aggTrade"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"E"</span><span class="p">:</span><span class="w"> </span><span class="mi">1726313202969</span><span class="p">,</span><span class="w">
      </span><span class="nl">"a"</span><span class="p">:</span><span class="w"> </span><span class="mi">2329235556</span><span class="p">,</span><span class="w">
      </span><span class="nl">"s"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTCINR"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"p"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5271343.57"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"q"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.002"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"f"</span><span class="p">:</span><span class="w"> </span><span class="mi">5383597285</span><span class="p">,</span><span class="w">
      </span><span class="nl">"l"</span><span class="p">:</span><span class="w"> </span><span class="mi">5383597285</span><span class="p">,</span><span class="w">
      </span><span class="nl">"T"</span><span class="p">:</span><span class="w"> </span><span class="mi">1726313202966</span><span class="p">,</span><span class="w">
      </span><span class="nl">"m"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>e</strong></td>
      <td>The event type (<code>aggTrade</code>), indicating an aggregated trade event.</td>
    </tr>
    <tr>
      <td><strong>E</strong></td>
      <td>The event time in milliseconds since epoch (<code>1726313202969</code>).</td>
    </tr>
    <tr>
      <td><strong>a</strong></td>
      <td>The aggregate trade ID (<code>2329235556</code>).</td>
    </tr>
    <tr>
      <td><strong>s</strong></td>
      <td>The trading pair symbol (<code>BTCINR</code>), indicating Bitcoin (BTC) traded against Indian Rupee (INR).</td>
    </tr>
    <tr>
      <td><strong>p</strong></td>
      <td>The price of the trade (<code>5271343.57 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>q</strong></td>
      <td>The quantity of the trade (<code>0.002 BTC</code>).</td>
    </tr>
    <tr>
      <td><strong>f</strong></td>
      <td>The first trade ID in the aggregate trade (<code>5383597285</code>).</td>
    </tr>
    <tr>
      <td><strong>l</strong></td>
      <td>The last trade ID in the aggregate trade (<code>5383597285</code>).</td>
    </tr>
    <tr>
      <td><strong>T</strong></td>
      <td>The trade time in milliseconds since epoch (<code>1726313202966</code>).</td>
    </tr>
    <tr>
      <td><strong>m</strong></td>
      <td>Whether the buyer is the market maker (<code>true</code>).</td>
    </tr>
  </tbody>
</table>

<h2 id='depth-update'>Depth Update</h2>

<p><code>GET /v1/market/depth/</code></p>

<p>Fetches the order book depth data for a specific trading pair. </p>

<p>It provides information about the current market depth, including bid and ask prices and their respective volumes, which is essential for understanding market liquidity.</p>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">fetchDepth</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/market/depth/</span><span class="dl">"</span><span class="p">;</span>   <span class="c1">// API endpoint for fetching order book depth data</span>
    <span class="kd">const</span> <span class="nx">contractPair</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">BTCINR</span><span class="dl">"</span><span class="p">;</span>           <span class="c1">// Trading pair for which the depth data is requested</span>
    <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">endpoint</span><span class="p">}${</span><span class="nx">contractPair</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span> <span class="c1">// Constructs the full URL by appending the trading pair to the endpoint</span>

    <span class="c1">// Call the getRequest function with the constructed URL</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">getRequest</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="p">{});</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">get_depth_update</span><span class="p">():</span>
    <span class="c1"># Prompt the user to enter a contract pair
</span>    <span class="n">contract_pair</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the contract pair (e.g., btc, eth): "</span><span class="p">).</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Validate the user input
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">contract_pair</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Invalid contract pair. Please enter a valid contract pair (e.g., btc, eth)."</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Construct the URL for the API request using the provided contract pair
</span>    <span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"https://api.pi42.com/v1/market/depth/</span><span class="si">{</span><span class="n">contract_pair</span><span class="si">}</span><span class="s">"</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Send the GET request to fetch depth updates
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_url</span><span class="p">)</span>
        <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># Raises an error for 4xx/5xx responses
</span>
        <span class="c1"># Parse the JSON response data
</span>        <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># Print the depth update in a formatted manner
</span>        <span class="k">print</span><span class="p">(</span><span class="s">'Depth update fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="c1"># Handle HTTP errors specifically
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Handle any other unexpected errors
</span>        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>contractPair</td>
            <td>string</td>
            <td>Yes</td>
            <td>The trading pair for which to fetch the order book depth data (e.g., BTCINR)</td>
        </tr>
    </tbody>
</table>

<h3 id='response-3'>Response</h3>

<p>The parameters contained in the response body are as follows:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Response</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"e"</span><span class="p">:</span><span class="w"> </span><span class="s2">"depthUpdate"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"E"</span><span class="p">:</span><span class="w"> </span><span class="mi">1726313210012</span><span class="p">,</span><span class="w">
    </span><span class="nl">"T"</span><span class="p">:</span><span class="w"> </span><span class="mi">1726313210009</span><span class="p">,</span><span class="w">
    </span><span class="nl">"s"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BTCINR"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"U"</span><span class="p">:</span><span class="w"> </span><span class="mi">5339856484581</span><span class="p">,</span><span class="w">
    </span><span class="nl">"u"</span><span class="p">:</span><span class="w"> </span><span class="mi">5339856497601</span><span class="p">,</span><span class="w">
    </span><span class="nl">"pu"</span><span class="p">:</span><span class="w"> </span><span class="mi">5339856483867</span><span class="p">,</span><span class="w">
    </span><span class="nl">"b"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="s2">"5271043.69"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"0.554"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"a"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">[</span><span class="w">
        </span><span class="s2">"5271396.49"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"0.866"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>e</strong></td>
      <td>The event type (<code>depthUpdate</code>), indicating a market depth update.</td>
    </tr>
    <tr>
      <td><strong>E</strong></td>
      <td>The event time in milliseconds since epoch (<code>1726313210012</code>).</td>
    </tr>
    <tr>
      <td><strong>T</strong></td>
      <td>The transaction time in milliseconds since epoch (<code>1726313210009</code>).</td>
    </tr>
    <tr>
      <td><strong>s</strong></td>
      <td>The trading pair symbol (<code>BTCINR</code>), indicating Bitcoin (BTC) traded against Indian Rupee (INR).</td>
    </tr>
    <tr>
      <td><strong>U</strong></td>
      <td>The first update ID in the update (<code>5339856484581</code>).</td>
    </tr>
    <tr>
      <td><strong>u</strong></td>
      <td>The last update ID in the update (<code>5339856497601</code>).</td>
    </tr>
    <tr>
      <td><strong>pu</strong></td>
      <td>The previous update ID (<code>5339856483867</code>).</td>
    </tr>
    <tr>
      <td><strong>b</strong></td>
      <td>Current bid prices and quantities. Each entry is an array where the first element is the price and the second element is the quantity. Example: <code>[["5271043.69", "0.554"]]</code>.</td>
    </tr>
    <tr>
      <td><strong>a</strong></td>
      <td>Current ask prices and quantities. Each entry is an array where the first element is the price and the second element is the quantity. Example: <code>[["5271396.49", "0.866"]]</code>.</td>
    </tr>
  </tbody>
</table>

<h2 id='klines'>Get Klines</h2>

<p><code>POST /v1/market/klines</code></p>

<p>Retrieves candlestick (kline) data for a specified trading pair and time interval. </p>

<p>It provides historical price data that can be used for charting and analysis, including start and end times, and limits on the number of records returned.</p>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">getKlines</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/market/klines</span><span class="dl">"</span><span class="p">;</span>

    <span class="c1">// Define the fixed values for positionId and amount (though not used in this function)</span>
    <span class="kd">const</span> <span class="nx">positionId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">18c6c979-b089-4e67-b627-4c2072d0d5cb</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// Replace with your actual position ID</span>
    <span class="kd">const</span> <span class="nx">amount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Replace with the actual amount you want to add</span>

    <span class="c1">// Prepare request payload</span>
    <span class="kd">const</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">pair</span><span class="p">:</span> <span class="dl">"</span><span class="s2">BTCINR</span><span class="dl">"</span><span class="p">,</span>
        <span class="na">interval</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1m</span><span class="dl">"</span><span class="p">,</span>
        <span class="c1">// Optional</span>
        <span class="na">startTime</span><span class="p">:</span> <span class="mi">1696425435000</span><span class="p">,</span>
        <span class="na">endTime</span><span class="p">:</span> <span class="mi">1696425435999</span><span class="p">,</span>
        <span class="na">limit</span><span class="p">:</span> <span class="mi">1000</span>
    <span class="p">};</span>

    <span class="c1">// Call the postRequest function</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">postRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">get_kline_data</span><span class="p">():</span>
  <span class="k">try</span><span class="p">:</span>
      <span class="c1"># User inputs
</span>      <span class="n">pair</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the trading pair (e.g., BTCINR): "</span><span class="p">).</span><span class="n">upper</span><span class="p">()</span>
      <span class="n">interval</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter the interval (e.g., 1m, 5m, 1h): "</span><span class="p">).</span><span class="n">lower</span><span class="p">()</span>

      <span class="c1"># Prepare the request body (JSON)
</span>      <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s">'pair'</span><span class="p">:</span> <span class="n">pair</span><span class="p">,</span>
          <span class="s">'interval'</span><span class="p">:</span> <span class="n">interval</span><span class="p">,</span>
          <span class="s">'limit'</span><span class="p">:</span> <span class="mi">1000</span>
      <span class="p">}</span>

      <span class="c1"># Headers for the POST request (no API key or signature required)
</span>      <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
          <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span>
      <span class="p">}</span>

      <span class="c1"># Construct the full URL for the Kline endpoint
</span>      <span class="n">kline_url</span> <span class="o">=</span> <span class="s">"https://api.pi42.com/v1/market/klines"</span>

      <span class="c1"># Send the POST request to get Kline data
</span>      <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">kline_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
      <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span> <span class="c1"># Raises an error for 4xx/5xx responses
</span>      <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
      <span class="k">print</span><span class="p">(</span><span class="s">'Kline data fetched successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

  <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="s">"Please enter valid inputs for pair, interval."</span><span class="p">)</span>
  <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>pair</td>
            <td>string</td>
            <td>Yes</td>
            <td>The trading pair for which to fetch kline data (e.g., BTCINR)</td>
        </tr>
        <tr>
            <td>interval</td>
            <td>string</td>
            <td>Yes</td>
            <td>The interval for each kline (e.g., "1m" for 1 minute, "5m" for 5 minutes)</td>
        </tr>
        <tr>
            <td>startTime</td>
            <td>number</td>
            <td>No</td>
            <td>The start time (in milliseconds) for the kline data (timestamp)</td>
        </tr>
        <tr>
            <td>endTime</td>
            <td>number</td>
            <td>No</td>
            <td>The end time (in milliseconds) for the kline data (timestamp)</td>
        </tr>
        <tr>
            <td>limit</td>
            <td>number</td>
            <td>No</td>
            <td>The maximum number of kline records to return</td>
        </tr>
    </tbody>
</table>

<h3 id='response-4'>Response</h3>

<p>The response parameters are described below:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"startTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1726312200000"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"open"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5270382.19"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"high"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5270408.64"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"low"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5270382.19"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"close"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5270382.19"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1726312259999"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"volume"</span><span class="p">:</span><span class="w"> </span><span class="s2">"59.102"</span><span class="w">
  </span><span class="p">},</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>startTime</strong></td>
      <td>The start time of the interval in milliseconds since epoch (<code>1726312200000</code>).</td>
    </tr>
    <tr>
      <td><strong>open</strong></td>
      <td>The opening price of the interval (<code>5270382.19 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>high</strong></td>
      <td>The highest price during the interval (<code>5270408.64 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>low</strong></td>
      <td>The lowest price during the interval (<code>5270382.19 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>close</strong></td>
      <td>The closing price of the interval (<code>5270382.19 INR</code>).</td>
    </tr>
    <tr>
      <td><strong>endTime</strong></td>
      <td>The end time of the interval in milliseconds since epoch (<code>1726312259999</code>).</td>
    </tr>
    <tr>
      <td><strong>volume</strong></td>
      <td>The trading volume during the interval (<code>59.102 BTC</code>).</td>
    </tr>
  </tbody>
</table>

<h1 id='web-sockets'>Web Sockets</h1>

<p>WebSockets are used to provide real-time updates and maintain a continuous connection between clients (traders) and servers (exchanges). </p>

<p>Here&#39;s how different web sockets work:</p>

<h2 id="authenticated-web-sockets">Authenticated Web Sockets</h2>

<p>Authenticated WebSockets require user validation to ensure that only authorized users can access the data or functionality provided such as receiving real-time updates about a trader&#39;s account.</p>

<p>For example,  balance changes, order executions, or margin updates.</p>

<aside class="notice"> Notes:
<ul>
  <li>Authenticated Web Socket stream base URL <code>https://fawss.pi42.com/auth-stream </code></li>
  <li>Requires listenkey that can be obtained from the <a href="#create-listen-key">Create Listen Key API</a></li>
</ul>
</aside>

<p>The WebSocket client connects to a server using a listen key and listens for various events related to trading activities and session management. Each event handler logs specific information when the event is received.</p>

<p>Event listeners are described below:</p>

<table>
        <thead>
            <tr>
                <th>Event</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>connect</td>
                <td>Triggered when the connection to the WebSocket server is open.</td>
            </tr>
            <tr>
                <td>newPosition</td>
                <td>Triggered when a new position is received from the server.</td>
            </tr>
            <tr>
                <td>orderFilled</td>
                <td>Triggered when an order is completely filled.</td>
            </tr>
            <tr>
                <td>orderPartiallyFilled</td>
                <td>Triggered when an order is partially filled.</td>
            </tr>
            <tr>
                <td>orderCancelled</td>
                <td>Triggered when an order is cancelled.</td>
            </tr>
            <tr>
                <td>orderFailed</td>
                <td>Triggered when an order fails.</td>
            </tr>
            <tr>
                <td>newOrder</td>
                <td>Triggered when a new order is created.</td>
            </tr>
            <tr>
                <td>updatePosition</td>
                <td>Triggered when a position is updated.</td>
            </tr>
            <tr>
                <td>closePosition</td>
                <td>Triggered when a position is closed.</td>
            </tr>
            <tr>
                <td>balanceUpdate</td>
                <td>Triggered when the balance is updated.</td>
            </tr>
            <tr>
                <td>newTrade</td>
                <td>Triggered when a new trade occurs.</td>
            </tr>
            <tr>
                <td>sessionExpired</td>
                <td>Triggered when the session expires.</td>
            </tr>
            <tr>
                <td>disconnect</td>
                <td>Triggered when the connection to the WebSocket server is closed.</td>
            </tr>
        </tbody>
</table>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">serverUrl</span> <span class="o">=</span> <span class="s2">`https://fawss.pi42.com/auth-stream/</span><span class="p">${</span><span class="nx">listenKey</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>

<span class="c1">// Create a new socket connection</span>
<span class="kd">const</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">(</span><span class="nx">serverUrl</span><span class="p">);</span>

<span class="c1">// Event listener for when the connection is open</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connected to WebSocket server</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Event listener for messages from the server</span>

<span class="c1">// Event listener for newPosition events</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">newPosition</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">New position received:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listen for order filled event</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">orderFilled</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Order filled:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listen for order partially filled event</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">orderPartiallyFilled</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Order partially filled:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listen for order cancelled event</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">orderCancelled</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Order cancelled:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listen for order failed event</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">orderFailed</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Order failed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listen for new order event</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">newOrder</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">New order:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listen for update position event</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">updatePosition</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Position updated:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listen for close position event</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">closePosition</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Position closed:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listen for balance update event</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">balanceUpdate</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Balance updated:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listen for new trade event</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">newTrade</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">New trade:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Listen for session expiry</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">sessionExpired</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Session Expired:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Event listener for when the connection is closed</span>
<span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">disconnect</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Disconnected from WebSocket server</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>

<h2 id="public-web-sockets">Public Web Sockets</h2>

<p>Public WebSockets are open to all clients and do not require authentication to establish a connection. They are useful for scenarios where the data being transmitted is not sensitive or where the application does not require user-specific interactions.</p>

<p>For example, to receive real-time updates on market data such as price changes, order book depth, and trade history without requiring authentication.</p>

<aside class="notice">

  Public Web Socket URL <code>https://fawss.pi42.com/</code>

</aside>

<p>Once connected, users can subscribe to different topics mentioned below:</p>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Example</th>
            <th>Listening Topic</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>contract_pair@depth_minGrouping</td>
            <td>btcinr@depth
            _
            0.1</td>
            <td>depthUpdate</td>
        </tr>
        <tr>
            <td>contract
            _pair@kline
            _
            interval</td>
            <td>btcinr@kline
            _
            1m</td>
            <td>kline</td>
        </tr>
        <tr>
            <td>contract
            _pair@markPrice</td>
            <td>btcinr@markPrice</td>
            <td>markPriceUpdate</td>
        </tr>
        <tr>
            <td>contract
            _pair@aggTrade</td>
            <td>btcinr@aggTrade</td>
            <td>aggTrade</td>
        </tr>
        <tr>
            <td>contract
            _pair@ticker</td>
            <td>btcinr@ticker</td>
            <td>24hrTicker</td>
        </tr>
        <tr>
            <td>contract
            _pair@marketInfo</td>
            <td>btcinr@marketInfo</td>
            <td>marketInfo</td>
        </tr>
        <tr>
            <td>markPriceArr</td>
            <td>N/A</td>
            <td>markPriceArr</td>
        </tr>
        <tr>
            <td>tickerArr</td>
            <td>N/A</td>
            <td>tickerArr</td>
        </tr>
        <tr>
            <td>All contracts details</td>
            <td>N/A</td>
            <td>allContractDetails</td>
        </tr>
</table>

<ul>
<li>Intervals: The intervals for kline (candlestick) data can be <code>1m</code>, <code>3m</code>, <code>5m</code>, <code>15m</code>, <code>30m</code>, <code>1h</code>, <code>2h</code>, <code>4h</code>, <code>6h</code>, <code>8h</code>, <code>12h</code>, <code>1d</code>, <code>3d</code>, <code>1w</code>, <code>1M</code>.</li>
<li>MinGroupings: Depth groupings vary by contract. For example, 0.1 is used for BTC.</li>
</ul>

<div class="highlight"><pre class="highlight plaintext"><code>import { io } from 'socket.io-client';

// WebSocket server URL
const serverUrl = 'https://fawss.pi42.com/';

// Create a new socket connection
const socket = io(serverUrl);

// Event listener for when the connection is open
socket.on('connect', () =&gt; {
  console.log('Connected to WebSocket server');
  subscribeToTopics();
});

// Event listener for when the connection is closed
socket.on('disconnect', () =&gt; {
  console.log('Disconnected from WebSocket server');
});

// Event listener for errors
socket.on('error', (error: any) =&gt; {
  console.error('Socket.IO error:', error);
});

// Function to subscribe to various WebSocket topics
function subscribeToTopics() {
  const topics = ['btcinr@depth_0.1', 'btcinr@markPrice']; // List of topics you want to subscribe to

  // Subscribe to each topic
  socket.emit('subscribe', {
    params: topics, // Sends the topics array to the WebSocket server
  });

  // Event listener for updates on various data topics
  socket.on('depthUpdate', (data) =&gt; {
    console.log('depthUpdate: ', data);
  });

  socket.on('kline', (data) =&gt; {
    console.log('kline: ', data);
  });

  socket.on('markPriceUpdate', (data) =&gt; {
    console.log('markPriceUpdate: ', data);
  });

  socket.on('aggTrade', (data) =&gt; {
    console.log('aggTrade: ', data);
  });

  socket.on('24hrTicker', (data) =&gt; {
    console.log('24hrTicker: ', data);
  });

  socket.on('marketInfo', (data) =&gt; {
    console.log('marketInfo: ', data);
  });

  socket.on('markPriceArr', (data) =&gt; {
    console.log('markPriceArr: ', data);
  });

  socket.on('tickerArr', (data) =&gt; {
    console.log('tickerArr: ', data);
  });

  socket.on('marginRate', (data) =&gt; {
    console.log('marginRate: ', data);
  });
}
</code></pre></div>

<h2 id="create-listen-key"> Create Listen Key </h2>

<p><code>POST /v1/retail/listen-key</code></p>

<p>Creates a new listen key for WebSocket connections. </p>

<p>A listen key is used to maintain a persistent connection to the WebSocket server, allowing you to receive real-time updates on user account data.</p>

<div class="highlight"><pre class="highlight plaintext"><code>const baseUrl = process.env.PI42_BASE_URL + '/v1/retail/listen-key';

// Function to generate a signature for the request
const generateSignature = (params: object, apiSecret: string) =&gt; {
  return crypto
    .createHmac('sha256', apiSecret)
    .update(JSON.stringify(params))
    .digest('hex');
};

// Function to call Create Listen Key API
async function createListenKey(apiKey: string, apiSecret: string) {
  const params = {
    timestamp: Date.now().toString(),
  };

  const signature = generateSignature(params, apiSecret);

  try {
    const response = await axios.post(baseUrl, params, {
      headers: {
        'api-key': apiKey,
        'Content-Type': 'application/json',
        'signature': signature,
      },
    });
    console.log('Create Listen Key Response:', response.data);
    return response.data.listenKey;
  } catch (error) {
    console.error(
      'Error creating Listen Key:',
      error.response ? error.response.data : error.message
    );
    throw error; // Rethrow the error for further handling
  }
}
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>timestamp</td>
            <td>string</td>
            <td>Yes</td>
            <td>The current timestamp in milliseconds to ensure request uniqueness and prevent replay attacks</td>
        </tr>
    </tbody>
</table>

<p>The <code>createListenKey</code> function also requires an <code>apiKey</code> and <code>apiSecret</code> for authentication, and these are included in the headers of the request:</p>

<ul>
<li><code>apiKey</code>: The API key for authenticating the request.</li>
<li><code>apiSecret</code>: The API secret used to generate the signature for request validation.</li>
</ul>

<p>The function generates a signature using HMAC SHA-256 encryption of the request parameters and sends a POST request to the API endpoint to create a new listen key. If successful, it logs and returns the listen key; otherwise, it logs and throws the error for further handling.</p>

<h3 id='reponse'>Reponse</h3>

<p>The response parameters are described below:</p>

<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Response</span><span class="w">

</span><span class="p">{</span><span class="w">
  </span><span class="nl">"listenKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"c44ec0b16e1e79d82473283a9736d2d037f105c39190ad48539fd6479a5b8ecc"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>listenKey</strong></td>
      <td>The unique identifier for the Listen Key, used to maintain a persistent connection for real-time data streams. Example: <code>c44ec0b16e1e79d82473283a9736d2d037f105c39190ad48539fd6479a5b8ecc</code>.</td>
    </tr>
  </tbody>
</table>

<h2 id="get-listen-key">Get Listen Key</h2>

<p><code>POST /v1/retail/listen-key</code></p>

<p>Retrieves a new listen key for WebSocket connections. </p>

<p>A listen key is used to maintain a persistent WebSocket connection, allowing you to receive real-time updates.</p>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">getListenKey</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/retail/listen-key</span><span class="dl">"</span><span class="p">;</span>

    <span class="c1">// Call the postRequest function</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">postRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="p">{});</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">create_or_update_listen_key</span><span class="p">():</span>
  <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

  <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
  <span class="p">}</span>

  <span class="c1"># Convert the parameters to a query string (if signing a query string)
</span>  <span class="n">data_to_sign</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">':'</span><span class="p">))</span>
  <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">data_to_sign</span><span class="p">)</span>

  <span class="c1"># Headers for the request
</span>  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
      <span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/json'</span><span class="p">,</span>
      <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="k">try</span><span class="p">:</span>
      <span class="c1"># Send the POST request to create or update a listen key
</span>      <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">listen_key_url</span><span class="si">}</span><span class="s">'</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
      <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
      <span class="n">response_data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
      <span class="k">print</span><span class="p">(</span><span class="s">'Listen key created or updated successfully:'</span><span class="p">,</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
  <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>None</td>
            <td>N/A</td>
            <td>No</td>
            <td>Retrieves a new listen key for WebSocket connections. <br/>A listen key is used to maintain a persistent WebSocket connection, allowing you to receive real-time updates.</td>
        </tr>
    </tbody>
</table>

<h2 id="update-listen-key">Update Listen Key</h2>

<p><code>PUT /v1/retail/listen-key</code></p>

<p>Updates the listen key for WebSocket connections. </p>

<p>Updating the listen key is necessary to maintain an active WebSocket connection and prevent disconnections due to inactivity.</p>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>None</td>
            <td>N/A</td>
            <td>No</td>
            <td>Updates the listen key for WebSocket connections. </td>
        </tr>
    </tbody>
</table>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">updateListenKey</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/retail/listen-key</span><span class="dl">"</span><span class="p">;</span>

    <span class="c1">// Call the getRequest function</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">putRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="p">{});</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">update_listen_key_expiry</span><span class="p">():</span>
  <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

  <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
  <span class="p">}</span>

  <span class="n">data_to_sign</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">':'</span><span class="p">))</span>

  <span class="c1"># Generate the signature using the provided helper function
</span>  <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">data_to_sign</span><span class="p">)</span>

  <span class="c1"># Headers for the PUT request
</span>  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
      <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="k">try</span><span class="p">:</span>
      <span class="c1"># Send the PUT request to update the listen key expiry
</span>      <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">listen_key_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
      <span class="k">print</span><span class="p">(</span><span class="s">'Listen key expiry updated successfully:'</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Failed </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div><h3 id='response'>Response</h3>
<p>The response contains a message as shown:</p>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="err">//</span><span class="w"> </span><span class="err">Response</span><span class="w">
   </span><span class="err">Listen</span><span class="w"> </span><span class="err">Key</span><span class="w"> </span><span class="err">expiry</span><span class="w"> </span><span class="err">time</span><span class="w"> </span><span class="err">updated</span><span class="w"> </span><span class="err">successfully.</span><span class="w">

</span></code></pre></div>

<h2 id="delete-listen-key">Delete Listen Key</h2>

<p><code>DELETE /v1/retail/listen-key</code></p>

<p>Deletes the listen key for WebSocket connections.</p>

<p>This action terminates the connection and stops the receipt of real-time updates.</p>

<div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">deleteListenKey</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">endpoint</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">/v1/retail/listen-key</span><span class="dl">"</span><span class="p">;</span>

    <span class="c1">// Call the deleteRequest function</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">deleteRequest</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">,</span> <span class="p">{});</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="k">def</span> <span class="nf">delete_listen_key</span><span class="p">():</span>
  <span class="c1"># Generate the current timestamp
</span>  <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>

  <span class="c1"># Prepare the data for the request (listenKey is passed in the URL path)
</span>  <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">'timestamp'</span><span class="p">:</span> <span class="n">timestamp</span>
  <span class="p">}</span>

  <span class="c1"># Generate the signature based on the params
</span>  <span class="n">data_to_sign</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s">','</span><span class="p">,</span> <span class="s">':'</span><span class="p">))</span>
  <span class="n">signature</span> <span class="o">=</span> <span class="n">generate_signature</span><span class="p">(</span><span class="n">api_secret</span><span class="p">,</span> <span class="n">data_to_sign</span><span class="p">)</span>

  <span class="c1"># Headers for the DELETE request
</span>  <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">'api-key'</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
      <span class="s">'signature'</span><span class="p">:</span> <span class="n">signature</span><span class="p">,</span>
      <span class="s">'accept'</span><span class="p">:</span> <span class="s">'*/*'</span>
  <span class="p">}</span>

  <span class="c1"># Construct the full URL, inserting the listenKey into the path
</span>  <span class="n">delete_listen_key_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s">/v1/retail/listen-key/"</span>

  <span class="k">try</span><span class="p">:</span>
      <span class="c1"># Send the DELETE request to delete the listen key
</span>      <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">delete_listen_key_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
      <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span> <span class="c1"># Raises an error for 4xx/5xx responses
</span>      <span class="k">print</span><span class="p">(</span><span class="s">'Listen key deleted successfully.'</span><span class="p">)</span>
  <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="n">err</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">err</span><span class="p">.</span><span class="n">response</span> <span class="k">else</span> <span class="n">err</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"An unexpected error occurred: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
</code></pre></div>

<table>
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>None</td>
            <td>N/A</td>
            <td>No</td>
            <td>Deletes the listen key for WebSocket connections</td>
        </tr>
    </tbody>
</table>

<h3 id='response-2'>Response</h3>

<p>The response body contains the message as shown in the snippet:</p>

<div class="highlight"><pre class="highlight plaintext"><code>Listen key deleted successfully.
</code></pre></div>

<h1 id="error-codes"> Error Codes </h1>

<p>Pi42 APIs utilize a set of custom error codes, each associated with an HTTP status code and a specific error message. These codes help users pinpoint the exact issue that caused the request to fail.</p>

<table>
  <thead>
    <tr>
      <th>Error Code</th>
      <th>HTTP Status Code</th>
      <th>Error Message</th>
      <th>API Endpoints</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>2303</td>
      <td>400</td>
      <td>Contract pair not found</td>
      <td><code>v1/exchange/update/leverage</code></td>
    </tr>
    <tr>
      <td>2304</td>
      <td>400</td>
      <td>Leverage value out of range</td>
      <td><code>v1/exchange/update/leverage</code></td>
    </tr>
    <tr>
      <td>2305</td>
      <td>400</td>
      <td>Leverage cannot be updated with open position</td>
      <td><code>v1/exchange/update/leverage</code></td>
    </tr>
    <tr>
      <td>2306</td>
      <td>400</td>
      <td>Leverage cannot be updated with open orders</td>
      <td><code>v1/exchange/update/leverage</code></td>
    </tr>
    <tr>
      <td>2307</td>
      <td>500</td>
      <td>Unable to update user leverage preference</td>
      <td><code>v1/exchange/update/leverage</code></td>
    </tr>
    <tr>
      <td>2400</td>
      <td>400</td>
      <td>Interval value is invalid</td>
      <td><code>v1/market/klines</code></td>
    </tr>
    <tr>
      <td>2401</td>
      <td>500</td>
      <td>Unable to fetch kline data</td>
      <td><code>v1/market/klines</code></td>
    </tr>
    <tr>
      <td>2402</td>
      <td>400</td>
      <td>Invalid contract pair</td>
      <td><code>v1/market/depth/{contractPair}<br/>v1/market/aggTrade/{contractPair}<br/>v1/market/ticker24Hr/{contractPair}</code></td>
    </tr>
    <tr>
      <td>2403</td>
      <td>500</td>
      <td>Unable to fetch depth update for given contract pair</td>
      <td><code>v1/market/depth/{contractPair}</code></td>
    </tr>
    <tr>
      <td>2404</td>
      <td>500</td>
      <td>Unable to fetch trade update for given contract pair</td>
      <td><code>v1/market/aggTrade/{contractPair}</code></td>
    </tr>
    <tr>
      <td>2405</td>
      <td>500</td>
      <td>Unable to fetch 24 hr ticker update for given contract pair</td>
      <td><code>v1/market/ticker24Hr/{contractPair}</code></td>
    </tr>
    <tr>
      <td>2406</td>
      <td>400</td>
      <td>Invalid market is provided</td>
      <td><code>v1/market/marketInfo</code></td>
    </tr>
    <tr>
      <td>2407</td>
      <td>500</td>
      <td>Unable to fetch market information</td>
      <td><code>v1/market/marketInfo</code></td>
    </tr>
    <tr>
      <td>2500</td>
      <td>400</td>
      <td>Account id not found</td>
      <td><code>v1/positions/{positionStatus}</code></td>
    </tr>
    <tr>
      <td>2501</td>
      <td>500</td>
      <td>Unable to fetch positions</td>
      <td><code>v1/positions/{positionStatus}</code></td>
    </tr>
    <tr>
      <td>2502</td>
      <td>400</td>
      <td>No position exists with provided position id</td>
      <td><code>v1/positions</code></td>
    </tr>
    <tr>
      <td>2503</td>
      <td>400</td>
      <td>Invalid contract pair</td>
      <td><code>v1/positions</code></td>
    </tr>
    <tr>
      <td>2504</td>
      <td>500</td>
      <td>Unable to fetch position for provided position id</td>
      <td><code>v1/positions</code></td>
    </tr>
    <tr>
      <td>3000</td>
      <td>400</td>
      <td>Incorrect device type in header values</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3001</td>
      <td>400</td>
      <td>Symbol is missing</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3003</td>
      <td>400</td>
      <td>Invalid leverage</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3004</td>
      <td>400</td>
      <td>Invalid order side</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3005</td>
      <td>400</td>
      <td>Order price not present</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3006</td>
      <td>400</td>
      <td>Quantity precision should be less than {value}</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3007</td>
      <td>400</td>
      <td>Price precision should be less than {value}</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3008</td>
      <td>400</td>
      <td>Limit price is required</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3009</td>
      <td>400</td>
      <td>Limit price is out of allowed values</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3010</td>
      <td>400</td>
      <td>Order quantity is out of range</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3011</td>
      <td>400</td>
      <td>Order declined, TP/SL will be activated instantly</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3012</td>
      <td>400</td>
      <td>Margin asset {asset} is not supported for this contract</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3013</td>
      <td>400</td>
      <td>Order placement for this contract pair is not allowed as there is already an open order</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3014</td>
      <td>400</td>
      <td>Order placement for this contract pair is not allowed as there is already an open position</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3015</td>
      <td>400</td>
      <td>Take profit/Stop loss orders cannot be placed while reducing position</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3018</td>
      <td>400</td>
      <td>Insufficient margin</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3019</td>
      <td>400</td>
      <td>Ref id already exists</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3020</td>
      <td>400</td>
      <td>API request limit exceeded</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3021</td>
      <td>400</td>
      <td>Order type is not supported</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3022</td>
      <td>500</td>
      <td>Order execution error</td>
      <td><code>v1/order/place-order</code></td>
    </tr>
    <tr>
      <td>3023</td>
      <td>500</td>
      <td>Order cancellation error</td>
      <td><code>v1/order/cancel-order</code></td>
    </tr>
  </tbody>
</table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="javascript">javascript</a>
                <a href="#" data-language-name="python">python</a>
          </div>
      </div>
    </div>
  </body>
</html>
